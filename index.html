<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Planner TKA — Personal Study Scheduler</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* ========== Reset & Base ========== */
        :root {
            --bg1: linear-gradient(135deg, #0f172a 0%, #0b1220 40%, #0b4a6f 100%);
            --card: rgba(255, 255, 255, 0.06);
            --glass: rgba(255, 255, 255, 0.04);
            --accent: #60a5fa;
            --accent-2: #7c3aed;
            --muted: rgba(255, 255, 255, 0.7);
            --success: #22c55e;
            --danger: #ef4444;
            --glass-border: rgba(255, 255, 255, 0.08);
            --transition: all 0.3s ease;
            font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html, body {
            height: 100%;
            scroll-behavior: smooth;
        }

        body {
            margin: 0;
            background: var(--bg1);
            color: #e6eef8;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            padding: 12px;
            display: flex;
            gap: 12px;
            align-items: flex-start;
            justify-content: center;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* ========== Parallax Effect ========== */
        .parallax-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiPgogIDxkZWZzPgogICAgPGxpbmVhckdyYWRpZW50IGlkPSJncmFkIiBncmFkaWVudFRyYW5zZm9ybT0icm90YXRlKDEzNSkiPgogICAgICA8c3RvcCBvZmZzZXQ9IjAlIiBzdHlsZT0ic3RvcC1jb2xvcjojMGYxNzJhO3N0b3Atb3BhY2l0eToxIiAvPgogICAgICA8c3RvcCBvZmZzZXQ9IjQwJSIgc3R5bGU9InN0b3AtY29sb3I6IzBiMTIyMDtzdG9wLW9wYWNpdHk6MSIgLz4KICAgICAgPHN0b3Agb2Zmc2V0PSIxMDAlIiBzdHlsZT0ic3RvcC1jb2xvcjojMGJhZDZmO3N0b3Atb3BhY2l0eToxIiAvPgogICAgPC9saW5lYXJHcmFkaWVudD4KICA8L2RlZnM+CiAgPHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0idXJsKCNncmFkKSIgLz4KICA8Y2lyY2xlIGN4PSI4MCUiIGN5PSIyMCUiIHI9IjE1JSIgZmlsbD0icmdiYSg5NiwgMTY1LCAyNTAsIDAuMDcpIiAvPgogIDxjaXJjbGUgY3g9IjIwJSIgY3k9IjgwJSIgcj0iMTAlIiBmaWxsPSJyZ2JhKDEyNCwgNTgsIDIzNywgMC4wNykiIC8+Cjwvc3ZnPg==');
            background-size: cover;
            z-index: -1;
            transform: translateZ(-10px) scale(2);
        }

        /* ========== APP LAYOUT ========== */
        .app {
            width: 100%;
            max-width: 1100px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            position: relative;
            z-index: 1;
        }

        .page {
            display: none;
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.5s ease, transform 0.5s ease;
        }

        .page.active {
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
            opacity: 1;
            transform: translateY(0);
        }

        @media (min-width: 901px) {
            .page.active {
                grid-template-columns: 1fr 420px;
            }
        }

        /* ========== Scroll Animations ========== */
        .fade-in {
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.6s ease, transform 0.6s ease;
        }

        .fade-in.visible {
            opacity: 1;
            transform: translateY(0);
        }

        .slide-in-left {
            opacity: 0;
            transform: translateX(-50px);
            transition: opacity 0.6s ease, transform 0.6s ease;
        }

        .slide-in-left.visible {
            opacity: 1;
            transform: translateX(0);
        }

        .slide-in-right {
            opacity: 0;
            transform: translateX(50px);
            transition: opacity 0.6s ease, transform 0.6s ease;
        }

        .slide-in-right.visible {
            opacity: 1;
            transform: translateX(0);
        }

        /* ========== NAVBAR ========== */
        .topbar {
            grid-column: 1/-1;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
            padding: 8px 0;
            position: relative;
            z-index: 100;
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(10px);
            border-radius: 14px;
            padding: 12px;
            margin-bottom: 10px;
            border: 1px solid var(--glass-border);
        }

        .brand {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .logo {
            width: 46px;
            height: 46px;
            border-radius: 12px;
            background: linear-gradient(135deg, var(--accent), var(--accent-2));
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 6px 20px rgba(124, 58, 237, 0.18);
            font-weight: 700;
            color: #fff;
            font-size: 18px;
            transition: transform 0.3s ease;
        }

        .logo:hover {
            transform: rotate(10deg);
        }

        .nav {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .nav a {
            color: var(--muted);
            text-decoration: none;
            padding: 8px 10px;
            border-radius: 8px;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .nav a::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: left 0.5s ease;
        }

        .nav a:hover::before {
            left: 100%;
        }

        .nav a.active {
            background: rgba(255, 255, 255, 0.03);
            color: #fff;
        }

        .nav a:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .hamburger {
            display: none;
            border: 0;
            background: transparent;
            color: var(--muted);
            font-size: 20px;
            cursor: pointer;
            z-index: 101;
        }

        /* Mobile menu styles */
        .mobile-menu {
            display: none;
            position: fixed;
            top: 0;
            right: 0;
            width: 70%;
            height: 100vh;
            background: linear-gradient(180deg, rgba(15, 23, 42, 0.95), rgba(11, 18, 32, 0.98));
            padding: 80px 20px 20px;
            box-shadow: -5px 0 25px rgba(0, 0, 0, 0.5);
            z-index: 99;
            backdrop-filter: blur(10px);
            border-left: 1px solid var(--glass-border);
            transform: translateX(100%);
            transition: transform 0.4s ease;
        }

        .mobile-menu.open {
            display: flex;
            flex-direction: column;
            transform: translateX(0);
        }

        .mobile-menu a {
            display: block;
            color: var(--muted);
            text-decoration: none;
            padding: 15px;
            border-radius: 8px;
            transition: var(--transition);
            margin-bottom: 10px;
            text-align: center;
            font-size: 18px;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .mobile-menu a:hover, .mobile-menu a.active {
            background: rgba(255, 255, 255, 0.05);
            color: #fff;
            transform: translateX(-5px);
        }

        .menu-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 98;
        }

        .menu-overlay.open {
            display: block;
        }

        @media (max-width: 900px) {
            .nav {
                display: none;
            }
            .hamburger {
                display: block;
            }
            .topbar {
                flex-wrap: wrap;
            }
            .brand {
                flex: 1;
                min-width: 0;
            }
            .brand > div {
                overflow: hidden;
            }
            .brand h1 {
                font-size: 14px;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
            }
            .brand .small {
                font-size: 10px;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
            }
        }

        /* ========== Panels ========== */
        .panel {
            background: linear-gradient(180deg, rgba(255, 255, 255, 0.02), rgba(255, 255, 255, 0.01));
            border-radius: 14px;
            padding: 20px;
            border: 1px solid var(--glass-border);
            box-shadow: 0 6px 30px rgba(2, 6, 23, 0.6);
            transition: var(--transition);
            backdrop-filter: blur(10px);
        }

        .panel:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(2, 6, 23, 0.7);
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        @media (max-width: 900px) {
            .calendar-grid {
                grid-template-columns: 1fr;
            }
        }

        .day-card {
            background: var(--card);
            border-radius: 12px;
            padding: 15px;
            min-height: 200px;
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.03);
            transition: var(--transition);
        }

        .day-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(2, 6, 23, 0.4);
        }

        .slot {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            align-items: center;
            gap: 8px;
        }

        .pill {
            padding: 6px 10px;
            border-radius: 10px;
            font-size: 13px;
            background: linear-gradient(90deg, rgba(255, 255, 255, 0.03), rgba(255, 255, 255, 0.01));
            border: 1px solid rgba(255, 255, 255, 0.02);
        }

        .pelajaran-badge {
            padding: 6px 10px;
            border-radius: 10px;
            font-weight: 600;
            background: linear-gradient(90deg, var(--accent), var(--accent-2));
            color: #04233a;
            box-shadow: 0 6px 18px rgba(96, 165, 250, 0.14);
            cursor: pointer;
            transition: var(--transition);
            font-size: 12px;
        }

        .pelajaran-badge:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(96, 165, 250, 0.25);
        }

        .actions {
            display: flex;
            gap: 8px;
            margin-top: 15px;
        }

        .btn {
            border: 0;
            padding: 10px 12px;
            border-radius: 10px;
            font-weight: 600;
            background: var(--glass);
            color: var(--muted);
            cursor: pointer;
            border: 1px solid rgba(255, 255, 255, 0.03);
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .btn:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: translateY(-2px);
        }

        .btn.primary {
            background: linear-gradient(90deg, var(--accent), var(--accent-2));
            color: #052034;
        }

        .btn.primary:hover {
            background: linear-gradient(90deg, var(--accent), #4f86e8);
            box-shadow: 0 6px 18px rgba(96, 165, 250, 0.25);
        }

        .btn.danger {
            background: rgba(239, 68, 68, 0.9);
            color: #fff;
        }

        .btn.danger:hover {
            background: rgba(220, 60, 60, 0.9);
        }

        /* sidebar */
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .today-view {
            padding: 15px;
            border-radius: 12px;
            background: var(--glass);
            border: 1px solid var(--glass-border);
        }

        .task-item {
            display: flex;
            gap: 8px;
            align-items: center;
            justify-content: space-between;
            padding: 10px;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.02);
            margin-bottom: 10px;
            transition: var(--transition);
        }

        .task-item:hover {
            background: rgba(255, 255, 255, 0.04);
            transform: translateX(5px);
        }

        .small {
            font-size: 12px;
            color: var(--muted);
        }

        /* inputs */
        .input, select, textarea {
            padding: 10px;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.06);
            background: rgba(255, 255, 255, 0.03);
            color: inherit;
            outline: none;
            width: 100%;
            transition: var(--transition);
            font-family: inherit;
        }

        .input:focus, select:focus, textarea:focus {
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(96, 165, 250, 0.2);
        }

        label {
            font-size: 12px;
            color: var(--muted);
            display: block;
            margin-bottom: 8px;
        }

        /* Materi Page Specific Styles */
        .materi-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .materi-split-view {
            display: flex;
            width: 100%;
            height: 220px;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(2, 6, 23, 0.7);
            position: relative;
        }

        .materi-half {
            flex: 1;
            padding: 25px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            cursor: pointer;
            transition: all 0.5s cubic-bezier(0.25, 0.8, 0.25, 1);
            position: relative;
            overflow: hidden;
            z-index: 1;
        }

        .materi-half::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(96, 165, 250, 0.2), rgba(76, 145, 240, 0.15));
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: -1;
        }

        .materi-half.tka {
            background: linear-gradient(135deg, rgba(96, 165, 250, 0.15), rgba(76, 145, 240, 0.1));
            border-right: 1px solid var(--glass-border);
        }

        .materi-half.mid {
            background: linear-gradient(135deg, rgba(124, 58, 237, 0.15), rgba(104, 48, 217, 0.1));
        }

        .materi-half.active {
            flex: 4;
            z-index: 2;
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.4);
        }

        .materi-half.active::before {
            opacity: 1;
        }

        .materi-half.inactive {
            flex: 1;
            opacity: 0.8;
            filter: blur(1px);
        }

        .materi-half h2 {
            font-size: 24px;
            margin: 0 0 10px 0;
            transition: var(--transition);
        }

        .materi-half.active h2 {
            font-size: 28px;
        }

        .materi-content {
            display: none;
            padding: 25px;
            background: var(--card);
            border-radius: 16px;
            margin-top: 15px;
            border: 1px solid var(--glass-border);
            animation: fadeIn 0.5s ease;
            transform-origin: top;
        }

        .materi-content.active {
            display: block;
            animation: slideIn 0.5s ease forwards;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Absensi Page Specific Styles */
        .absensi-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .streak-container {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 20px;
            padding: 20px;
            background: var(--card);
            border-radius: 16px;
            border: 1px solid var(--glass-border);
        }

        .streak-visual {
            position: relative;
            width: 120px;
            height: 120px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .streak-circle {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: conic-gradient(var(--accent) 0%, var(--accent-2) 50%, rgba(255, 255, 255, 0.1) 0%);
            position: absolute;
        }

        .streak-count {
            font-size: 32px;
            font-weight: 800;
            color: var(--accent);
            z-index: 2;
        }

        .badges-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .badge {
            background: var(--card);
            border-radius: 12px;
            padding: 15px;
            text-align: center;
            border: 1px solid var(--glass-border);
            transition: var(--transition);
        }

        .badge:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }

        .badge.locked {
            filter: grayscale(1);
            opacity: 0.6;
        }

        /* Settings Page Specific Styles */
        .settings-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .settings-group {
            margin-bottom: 20px;
            padding: 20px;
            background: var(--card);
            border-radius: 16px;
            border: 1px solid var(--glass-border);
        }

        .settings-group h3 {
            margin-top: 0;
            border-bottom: 1px solid var(--glass-border);
            padding-bottom: 12px;
        }

        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .setting-item:last-child {
            border-bottom: none;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(255, 255, 255, 0.1);
            transition: .4s;
            border-radius: 24px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: var(--accent);
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        /* Calendar View Styles */
        .calendar-view {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
            margin-top: 20px;
        }

        .calendar-day {
            background: var(--card);
            border-radius: 10px;
            padding: 12px;
            min-height: 130px;
            border: 1px solid var(--glass-border);
            cursor: pointer;
            transition: var(--transition);
        }

        .calendar-day:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: translateY(-3px);
        }

        .calendar-day.current {
            border: 2px solid var(--accent);
        }

        .calendar-day.has-tasks {
            background: linear-gradient(135deg, rgba(96, 165, 250, 0.15), rgba(76, 145, 240, 0.1));
        }

        .day-number {
            font-weight: bold;
            margin-bottom: 10px;
            text-align: center;
        }

        .day-tasks {
            font-size: 12px;
            max-height: 80px;
            overflow-y: auto;
        }

        .day-task-item {
            padding: 5px;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.05);
            margin-bottom: 5px;
        }

        .calendar-header {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
            text-align: center;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .calendar-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: var(--card);
            border-radius: 16px;
            padding: 25px;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
            border: 1px solid var(--glass-border);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }

        .modal.show .modal-content {
            transform: scale(1);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 1px solid var(--glass-border);
            padding-bottom: 15px;
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--muted);
            font-size: 24px;
            cursor: pointer;
            transition: var(--transition);
        }

        .modal-close:hover {
            color: #fff;
            transform: rotate(90deg);
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .materi-split-view {
                flex-direction: column;
                height: auto;
            }
            
            .materi-half {
                min-height: 120px;
                padding: 15px;
            }
            
            .materi-half.active {
                min-height: 350px;
            }
            
            .calendar-view {
                grid-template-columns: repeat(7, 1fr);
                gap: 5px;
            }
            
            .calendar-day {
                min-height: 90px;
                padding: 8px;
            }
            
            .day-tasks {
                display: none;
            }
            
            .streak-container {
                flex-direction: column;
                text-align: center;
                gap: 15px;
            }
            
            .streak-visual {
                width: 100px;
                height: 100px;
            }
            
            .streak-count {
                font-size: 28px;
            }
            
            .panel {
                padding: 15px;
            }
            
            .badges-container {
                grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
            }
            
            /* Improved mobile layout for home page */
            .page.active {
                display: flex;
                flex-direction: column;
            }
            
            .sidebar {
                order: 2;
            }
            
            #home-page > section:first-child {
                order: 1;
            }
            
            .actions {
                flex-wrap: wrap;
            }
            
            .btn {
                flex: 1;
                min-width: 120px;
                justify-content: center;
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 8px;
            }
            
            .logo {
                width: 40px;
                height: 40px;
                font-size: 16px;
            }
            
            .calendar-view {
                grid-template-columns: repeat(7, 1fr);
            }
            
            .calendar-day {
                min-height: 70px;
                font-size: 12px;
                padding: 5px;
            }
            
            .day-number {
                font-size: 14px;
            }
            
            .materi-half {
                padding: 15px;
            }
            
            .materi-half h2 {
                font-size: 20px;
            }
            
            .materi-half.active h2 {
                font-size: 24px;
            }
            
            .btn {
                padding: 8px 10px;
                font-size: 14px;
            }
            
            /* Better spacing for materi content */
            .materi-content {
                padding: 15px;
            }
            
            .materi-content h4 {
                margin: 15px 0 8px 0;
            }
            
            .materi-content p {
                margin-bottom: 12px;
            }
            
            /* Better spacing for absensi page */
            .absensi-container .panel {
                padding: 15px;
            }
            
            #btn-checkin {
                margin-top: 15px;
            }
        }

        /* Animation for the curtain effect */
        @keyframes curtainOpen {
            from {
                transform: scaleX(0);
                opacity: 0;
            }
            to {
                transform: scaleX(1);
                opacity: 1;
            }
        }

        .curtain-open {
            animation: curtainOpen 0.5s ease forwards;
            transform-origin: left;
        }

        /* Ref list styles */
        .ref-list {
            padding-left: 20px;
            margin-bottom: 15px;
        }

        .ref-list li {
            margin-bottom: 10px;
            line-height: 1.4;
        }

        a.ref-link {
            color: var(--accent);
            text-decoration: none;
            font-weight: 600;
            transition: var(--transition);
        }

        a.ref-link:hover {
            text-decoration: underline;
            color: var(--accent-2);
        }

        /* New styles for updated schedule */
        .schedule-info {
            padding: 15px;
            background: rgba(96, 165, 250, 0.1);
            border-radius: 12px;
            margin-bottom: 15px;
            border-left: 4px solid var(--accent);
        }

        .time-slot {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .time-slot:last-child {
            border-bottom: none;
        }

        /* Floating action button for mobile */
        .floating-btn {
            display: none;
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--accent), var(--accent-2));
            color: white;
            border: none;
            box-shadow: 0 6px 20px rgba(96, 165, 250, 0.3);
            z-index: 99;
            justify-content: center;
            align-items: center;
            font-size: 24px;
            transition: var(--transition);
        }

        .floating-btn:hover {
            transform: translateY(-5px) rotate(90deg);
            box-shadow: 0 10px 25px rgba(96, 165, 250, 0.4);
        }

        @media (max-width: 768px) {
            .floating-btn {
                display: flex;
            }
        }

        /* Loading animation */
        @keyframes pulse {
            0% { opacity: 0.6; }
            50% { opacity: 1; }
            100% { opacity: 0.6; }
        }

        .loading {
            animation: pulse 1.5s infinite;
        }

        /* Progress bar */
        .progress-container {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--accent), var(--accent-2));
            border-radius: 4px;
            transition: width 0.3s ease;
        }
        
        /* Confetti animation for check-in */
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background-color: var(--accent);
            opacity: 0;
            z-index: 1000;
            pointer-events: none;
        }
        
        @keyframes confetti-fall {
            0% {
                transform: translateY(-100vh) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }
        
        /* Attendance history styles */
        .attendance-history {
            margin-top: 20px;
        }
        
        .history-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(30px, 1fr));
            gap: 5px;
            margin-top: 10px;
        }
        
        .history-day {
            width: 30px;
            height: 30px;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            background: var(--card);
            border: 1px solid var(--glass-border);
        }
        
        .history-day.present {
            background: linear-gradient(135deg, var(--success), #16a34a);
            color: white;
        }
        
        .history-day.absent {
            background: rgba(255, 255, 255, 0.05);
        }
        
        /* Animation for check-in button */
        @keyframes pulse-glow {
            0% {
                box-shadow: 0 0 0 0 rgba(96, 165, 250, 0.7);
            }
            70% {
                box-shadow: 0 0 0 10px rgba(96, 165, 250, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(96, 165, 250, 0);
            }
        }
        
        .pulse-animation {
            animation: pulse-glow 2s infinite;
        }
    </style>
</head>
<body>
    <div class="parallax-bg"></div>
    
    <div class="app">
        <div class="topbar">
            <div class="brand">
                <div class="logo">TKA</div>
                <div>
                    <h1 style="margin:0;font-size:16px">Planner TKA — Personal</h1>
                    <p class="small" style="margin:0">Kalender belajar • Materi TKA & Mid-semester • Absensi</p>
                </div>
            </div>

            <div>
                <nav class="nav">
                    <a href="#home" class="nav-link active" data-page="home">Home</a>
                    <a href="#materi" class="nav-link" data-page="materi">Materi</a>
                    <a href="#absensi" class="nav-link" data-page="absensi">Absensi</a>
                    <a href="#settings" class="nav-link" data-page="settings">Pengaturan</a>
                </nav>
                <button class="hamburger" id="hamburger">☰</button>
                
                <div class="mobile-menu" id="mobileMenu">
                    <a href="#home" class="nav-link active" data-page="home">Home</a>
                    <a href="#materi" class="nav-link" data-page="materi">Materi</a>
                    <a href="#absensi" class="nav-link" data-page="absensi">Absensi</a>
                    <a href="#settings" class="nav-link" data-page="settings">Pengaturan</a>
                </div>
                
                <div class="menu-overlay" id="menuOverlay"></div>
            </div>
        </div>

        <!-- Home Page -->
        <div id="home-page" class="page active">
            <section class="panel fade-in">
                <h2 style="margin:0 0 8px 0">Kalender Mingguan</h2>
        
                
                <div class="schedule-info panel">
                    <h4 style="margin:0 0 8px 0">Jadwal Belajar Baru</h4>
                    <div class="time-slot">
                        <span>Pagi</span>
                        <span>09:00 - 10:00</span>
                    </div>
                    <div class="time-slot">
                        <span>Istirahat</span>
                        <span>10:00 - 10:15</span>
                    </div>
                    <div class="time-slot">
                        <span>Pagi</span>
                        <span>10:15 - 11:00</span>
                    </div>
                    <div class="time-slot">
                        <span>Sekolah</span>
                        <span>12:00 - 17:00</span>
                    </div>
                    <div class="time-slot">
                        <span>Istirahat & Makan Malam</span>
                        <span>17:00 - 18:30</span>
                    </div>
                    <div class="time-slot">
                        <span>Malam</span>
                        <span>18:30 - 20:00</span>
                    </div>
                    <div class="time-slot">
                        <span>Istirahat</span>
                        <span>20:00 - 20:15</span>
                    </div>
                    <div class="time-slot">
                        <span>Malam</span>
                        <span>20:15 - 21:45</span>
                    </div>
                    <div class="time-slot">
                        <span>Istirahat</span>
                        <span>21:45 - 22:00</span>
                    </div>
                    <div class="time-slot">
                        <span>Malam</span>
                        <span>22:00 - 23:00+</span>
                    </div>
                </div>

                <div id="calendar" class="calendar-grid" style="margin-top:12px"></div>

                <div style="margin-top:12px;display:flex;gap:8px;flex-wrap:wrap">
                    <button id="btn-add" class="btn"><i class="fas fa-plus"></i> Tambah Kegiatan</button>
                    <button id="btn-clear" class="btn danger"><i class="fas fa-trash"></i> Reset Semua</button>
                    <button id="btn-view-calendar" class="btn primary"><i class="fas fa-calendar"></i> Lihat Kalender Bulanan</button>
                </div>

               
            </section>

            <aside class="sidebar">
                <div class="panel today-view fade-in">
                    <h3>Hari Ini — <span id="today-date"></span></h3>
                    <div id="today-tasks" style="margin-top:8px"></div>

                    <div style="margin-top:8px">
                        <label><input type="checkbox" id="toggle-notif"> Izinkan notifikasi pengingat</label>
                    </div>

                    <div style="margin-top:8px" class="controls">
                        <button id="btn-view-today" class="btn primary"><i class="fas fa-eye"></i> Lihat Rinci Hari Ini</button>
                    </div>
                </div>

                <div class="panel fade-in">
                    <h4>Progress Mingguan</h4>
                    <p class="small">Ringkasan kegiatan yang sudah direncanakan minggu ini.</p>
                    <div id="weekly-summary" style="margin-top:8px"></div>
                </div>
            </aside>
        </div>

        <!-- Materi Page -->
        <div id="materi-page" class="page">
            <div class="materi-container">
                <div class="panel">
                    <h2 style="margin:0 0 8px 0">Materi & Referensi Kelas 12</h2>
                    <p class="small">Pilih kategori: TKA (materi resmi) atau Mid-semester (mapel SMK Kelas 12).</p>
                </div>

                <div class="materi-split-view">
                    <div class="materi-half tka active" data-content="tka-content">
                        <h2>TKA</h2>
                        <p>Materi resmi Tes Kompetensi Akademik</p>
                    </div>
                    <div class="materi-half mid" data-content="mid-content">
                        <h2>Mid-semester</h2>
                        <p>Materi untuk ujian mid semester SMK</p>
                    </div>
                </div>

                <div id="tka-content" class="materi-content active">
                    <!-- TKA content will be injected here -->
                </div>

                <div id="mid-content" class="materi-content">
                    <!-- Mid-semester content will be injected here -->
                </div>
            </div>
        </div>

        <!-- Absensi Page -->
        <div id="absensi-page" class="page">
            <div class="absensi-container">
                <div class="panel">
                    <h2 style="margin:0 0 8px 0">Absensi & Streak</h2>
                    <p class="small">Catat kehadiran belajar harian, lihat streak, dan dapatkan badge.</p>
                </div>

                <div class="panel streak-container">
                    <div class="streak-visual">
                        <div class="streak-circle" id="streak-circle"></div>
                        <div class="streak-count" id="streak-count">0</div>
                    </div>
                    <div style="flex:1">
                        <h3 style="margin-top:0">Streak Belajar</h3>
                        <p class="small">Konsistensi adalah kunci kesuksesan. Check-in setiap hari untuk membangun streak dan mendapatkan penghargaan.</p>
                        <button id="btn-checkin" class="btn primary pulse-animation"><i class="fas fa-check"></i> Check-in Hari Ini</button>
                    </div>
                </div>

                <div class="panel">
                    <h4>Riwayat Kehadiran</h4>
                    <p class="small">Lihat sejarah kehadiran belajar Anda dalam 30 hari terakhir.</p>
                    <div class="attendance-history">
                        <div class="history-grid" id="attendance-history">
                            <!-- Attendance history will be injected here -->
                        </div>
                    </div>
                </div>

                <div class="panel">
                    <h4>Badges & Penghargaan</h4>
                    <p class="small">Kumpulkan badge dengan menyelesaikan tantangan belajar.</p>
                    
                    <div class="badges-container" id="badges">
                        <!-- Badges will be injected here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings Page -->
        <div id="settings-page" class="page">
            <div class="settings-container">
                <div class="panel">
                    <h2 style="margin:0 0 8px 0">Pengaturan</h2>
                    <p class="small">Kelola preferensi dan pengaturan aplikasi.</p>
                </div>

                <div class="panel settings-group">
                    <h3>Notifikasi</h3>
                    
                    <div class="setting-item">
                        <div>
                            <label>Notifikasi Pengingat</label>
                            <p class="small">Aktifkan notifikasi untuk jadwal belajar</p>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="toggle-notif-settings">
                            <span class="slider"></span>
                        </label>
                    </div>
                    
                    <div class="setting-item">
                        <div>
                            <label>Alarm per Pelajaran</label>
                            <p class="small">Bunyikan alarm saat membuka setiap pelajaran</p>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="toggle-per-lesson-alarm">
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>

                <div class="panel settings-group">
                    <h3>Tampilan</h3>
                    
                    <div class="setting-item">
                        <div>
                            <label>Mode Gelap</label>
                            <p class="small">Gunakan tema gelap untuk mengurangi ketegangan mata</p>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="toggle-dark-mode" checked>
                            <span class="slider"></span>
                        </label>
                    </div>
                    
                    <div class="setting-item">
                        <div>
                            <label>Animasi</label>
                            <p class="small">Aktifkan efek animasi dan transisi</p>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="toggle-animations" checked>
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>

                <div class="panel settings-group">
                    <h3>Data</h3>
                    
                    <div class="setting-item">
                        <div>
                            <label>Ekspor Data</label>
                            <p class="small">Simpan cadangan data jadwal dan progress</p>
                        </div>
                        <button id="btn-export" class="btn primary"><i class="fas fa-download"></i> Ekspor</button>
                    </div>
                    
                    <div class="setting-item">
                        <div>
                            <label>Impor Data</label>
                            <p class="small">Muat data dari file cadangan</p>
                        </div>
                        <button id="btn-import" class="btn"><i class="fas fa-upload"></i> Impor</button>
                    </div>
                    
                    <div class="setting-item">
                        <div>
                            <label>Reset Data</label>
                            <p class="small">Hapus semua data dan kembali ke pengaturan awal</p>
                        </div>
                        <button id="btn-reset-all" class="btn danger"><i class="fas fa-redo"></i> Reset</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Calendar Modal -->
        <div id="calendar-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="calendar-modal-title">Kalender Bulanan</h3>
                    <button class="modal-close" id="calendar-modal-close">&times;</button>
                </div>
                <div class="calendar-nav">
                    <button id="calendar-prev" class="btn"><i class="fas fa-chevron-left"></i></button>
                    <h4 id="calendar-month-year">Mei 2023</h4>
                    <button id="calendar-next" class="btn"><i class="fas fa-chevron-right"></i></button>
                </div>
                <div class="calendar-header">
                    <div>Min</div>
                    <div>Sen</div>
                    <div>Sel</div>
                    <div>Rab</div>
                    <div>Kam</div>
                    <div>Jum</div>
                    <div>Sab</div>
                </div>
                <div id="calendar-days" class="calendar-view">
                    <!-- Calendar days will be injected here -->
                </div>
            </div>
        </div>

        <!-- Day Detail Modal -->
        <div id="day-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="day-modal-title">Detail Hari</h3>
                    <button class="modal-close" id="day-modal-close">&times;</button>
                </div>
                <div id="day-modal-content">
                    <!-- Day details will be injected here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Floating action button for mobile -->
    <button class="floating-btn" id="floating-btn">+</button>

    <!-- Modal Form for Adding/Editing Tasks -->
    <div id="taskModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h4 id="modalTitle">Tambah / Edit Kegiatan</h4>
                <button class="modal-close" id="task-modal-close">&times;</button>
            </div>
            <div style="max-height:60vh;overflow:auto;padding-right:8px">
                <label>Judul Kegiatan</label><input id="m-inp-title" class="input" placeholder="Contoh: Belajar Matematika (Trigonometri)">
                <label>Pelajaran / Tag</label>
                <select id="m-inp-subject" class="input"></select>
                <div style="display:flex;gap:8px;margin-top:8px">
                    <div style="flex:1"><label>Hari</label><select id="m-inp-day" class="input"></select></div>
                    <div style="flex:1"><label>Slot</label>
                        <select id="m-inp-slot" class="input">
                            <option value="slot1">09:00 - 10:00</option>
                            <option value="slot2">10:15 - 11:00</option>
                            <option value="slot3">18:30 - 20:00</option>
                            <option value="slot4">20:15 - 21:45</option>
                            <option value="slot5">22:00 - 23:00</option>
                        </select>
                    </div>
                </div>
                <div style="display:flex;gap:8px;margin-top:8px">
                    <div style="flex:1"><label>Durasi (menit)</label><input id="m-inp-duration" type="number" class="input" value="60" min="5"></div>
                    <div style="flex:1"><label>Pengingat (menit sebelum)</label><input id="m-inp-remind" type="number" class="input" value="10" min="0"></div>
                </div>
            </div>
            <div style="display:flex;gap:8px;margin-top:10px;justify-content:flex-end">
                <button id="m-save-task" class="btn primary">Simpan</button>
                <button id="m-cancel-task" class="btn">Batal</button>
            </div>
        </div>
    </div>

    <script>
        // ========== DATA DAN KONSTANTA ==========
        const SUBJECTS = [
            "Matematika", "Bahasa Indonesia", "Bahasa Inggris", "Sejarah", "PKN",
            "Tugas Film", "Ngoding", "Banner", "Game",
            "mid_matematika", "mid_bahasa_indonesia", "mid_bahasa_inggris", "mid_dkv", 
            "mid_desain_media_interaktif", "mid_pkk", "mid_kimia", "mid_fisika", 
            "mid_agama", "mid_ppkn", "mid_sejarah", "mid_ke-nu"
        ];

        // Updated time slots with breaks
        const SLOTS = {
            slot1: { label: '09:00 - 10:00' },
            slot2: { label: '10:15 - 11:00' },
            slot3: { label: '18:30 - 20:00' },
            slot4: { label: '20:15 - 21:45' },
            slot5: { label: '22:00 - 23:00' }
        };

        const DAYS = ["monday", "tuesday", "wednesday", "thursday", "friday", "saturday", "sunday"];
        const DAY_LABEL = { 
            monday: 'Senin', tuesday: 'Selasa', wednesday: 'Rabu', thursday: 'Kamis', 
            friday: 'Jumat', saturday: 'Sabtu', sunday: 'Minggu' 
        };

        // Materi data
        const TKA_MATERI = {
            "Matematika": {
                title: "Matematika (TKA) — Kisi & Topik Utama Kelas 12",
                summary: "Bilangan, Aljabar, Fungsi, Geometri & Trigonometri, Data & Peluang, Statistika, Barisan & Deret, Limit, Turunan, Integral. Latihan cepat & pemahaman konsep sesuai kisi TKA.",
                refs: [
                    { name: "Pusmendik - Matematika (TKA)", url: "https://pusmendik.kemdikbud.go.id/tka/tka/view/mata-pelajaran-wajib/sma/matematika" },
                    { name: "Khan Academy (Kalkulus)", url: "https://id.khanacademy.org/math/calculus-1" },
                    { name: "Ruang Guru - Matematika Peminatan", url: "https://www.ruangguru.com/blog/matematika-peminatan-kelas-12" }
                ],
                examples: [
                    { q: "Jika f(x)=2x^2 −3x +1, cari f(2).", a: "3" },
                    { q: "Selesaikan: 2x+5=13", a: "x=4" }
                ]
            },
            "Bahasa Indonesia": {
                title: "Bahasa Indonesia — TKA Kelas 12",
                summary: "Pemahaman bacaan, teks fungsional, kosakata, struktur teks, menulis essay, proposal, karya ilmiah. Fokus soal analisis wacana & ide pokok.",
                refs: [
                    { name: "Pusmendik - Bahasa Indonesia", url: "https://pusmendik.kemdikbud.go.id/tka/tka/view/mata-pelajaran-wajib/sma/bahasa-indonesia" },
                    { name: "KBBI Online", url: "https://kbbi.kemdikbud.go.id" },
                    { name: "Ruang Guru - Bahasa Indonesia Kelas 12", url: "https://www.ruangguru.com/blog/bahasa-indonesia-kelas-12" }
                ],
                examples: [
                    { q: "Apa ide pokok paragraf?", a: "(contoh jawaban)" }
                ]
            },
            "Bahasa Inggris": {
                title: "Bahasa Inggris — TKA Kelas 12",
                summary: "Reading comprehension (various teks), grammar dasar, vocabulary in context, writing essays, reports. Teknik scanning & skimming.",
                refs: [
                    { name: "Pusmendik - Bahasa Inggris", url: "https://pusmendik.kemdikbud.go.id/tka/tka/view/mata-pelajaran-wajib/sma/bahasa-inggris" },
                    { name: "British Council - LearnEnglish Teens", url: "https://learnenglishteens.britishcouncil.org" },
                    { name: "Ruang Guru - Bahasa Inggris Kelas 12", url: "https://www.ruangguru.com/blog/bahasa-inggris-kelas-12" }
                ],
                examples: [
                    { q: "By the time she arrived, we ___ dinner.", a: "had finished" }
                ]
            }
        };

        const MID_MATERI = {
            "mid_matematika": { 
                title: "Matematika (Mid) Kelas 12", 
                summary: "Kisi-kisi mid: aljabar, trigonometri terapan, statistika dasar, limit, turunan, integral.",
                refs: [
                    { name: 'Ruang Guru - Matematika SMK Kelas 12', url: 'https://www.ruangguru.com/blog/matematika-smk-kelas-12' }
                ],
                examples: [
                    { q: 'Selesaikan: 3x-4=11', a: 'x=5' }
                ]
            },
            "mid_bahasa_indonesia": { 
                title: "Bahasa Indonesia (Mid) Kelas 12", 
                summary: "Menulis esai pendek, ringkasan, identifikasi ide pokok, proposal, laporan, karya ilmiah sederhana.",
                refs: [
                    { name: 'Ruang Guru - Bahasa Indonesia SMK Kelas 12', url: 'https://www.ruangguru.com/blog/bahasa-indonesia-smk-kelas-12' }
                ],
                examples: [
                    { q: 'Ringkas paragraf berikut...', a: '(jawaban contoh)' }
                ]
            },
            "mid_bahasa_inggris": { 
                title: "Bahasa Inggris (Mid) Kelas 12", 
                summary: "Reading & use of English, tenses, short essay, business correspondence, job application.",
                refs: [
                    { name: 'British Council - LearnEnglish Teens', url: 'https://learnenglishteens.britishcouncil.org' },
                    { name: 'Ruang Guru - Bahasa Inggris SMK Kelas 12', url: 'https://www.ruangguru.com/blog/bahasa-inggris-smk-kelas-12' }
                ],
                examples: [
                    { q: 'Choose correct tense...', a: '(jawaban)' }
                ]
            }
        };

        const BADGES = [
            { id: 1, name: "Pemula", description: "Check-in pertama", requiredStreak: 1, icon: "🥉" },
            { id: 2, name: "Konsisten", description: "Check-in 7 hari berturut-turut", requiredStreak: 7, icon: "🥈" },
            { id: 3, name: "Ahli", description: "Check-in 30 hari berturut-turut", requiredStreak: 30, icon: "🥇" },
            { id: 4, name: "Legenda", description: "Check-in 100 hari berturut-turut", requiredStreak: 100, icon: "🏆" }
        ];

        // ========== SISTEM PENYIMPANAN DATA ==========
        const STORAGE_KEY = "tka_planner_v6";
        let state = { 
            tasks: {}, // Berbasis tanggal (YYYY-MM-DD)
            attendance: {}, 
            settings: { 
                notifications: false, 
                perLessonAlarm: false,
                darkMode: true,
                animations: true
            }, 
            streak: {
                count: 0,
                lastCheck: null,
                badges: []
            },
            currentCalendarView: new Date(),
            weeklyTemplate: {
                monday: { slot1: [], slot2: [], slot3: [], slot4: [], slot5: [] },
                tuesday: { slot1: [], slot2: [], slot3: [], slot4: [], slot5: [] },
                wednesday: { slot1: [], slot2: [], slot3: [], slot4: [], slot5: [] },
                thursday: { slot1: [], slot2: [], slot3: [], slot4: [], slot5: [] },
                friday: { slot1: [], slot2: [], slot3: [], slot4: [], slot5: [] },
                saturday: { slot1: [], slot2: [], slot3: [], slot4: [], slot5: [] },
                sunday: { slot1: [], slot2: [], slot3: [], slot4: [], slot5: [] }
            }
        };

        // ========== FUNGSI UTILITAS ==========
        function getTasksForDate(date) {
            const dateStr = date.toISOString().split('T')[0];
            
            if (state.tasks[dateStr]) {
                return state.tasks[dateStr];
            }
            
            const dayOfWeek = date.getDay();
            const dayKey = dayOfWeek === 0 ? 'sunday' : 
                          dayOfWeek === 1 ? 'monday' :
                          dayOfWeek === 2 ? 'tuesday' :
                          dayOfWeek === 3 ? 'wednesday' :
                          dayOfWeek === 4 ? 'thursday' :
                          dayOfWeek === 5 ? 'friday' : 'saturday';
            
            return JSON.parse(JSON.stringify(state.weeklyTemplate[dayKey]));
        }

        function saveTasksForDate(date, tasks) {
            const dateStr = date.toISOString().split('T')[0];
            state.tasks[dateStr] = tasks;
            
            const dayOfWeek = date.getDay();
            const dayKey = dayOfWeek === 0 ? 'sunday' : 
                          dayOfWeek === 1 ? 'monday' :
                          dayOfWeek === 2 ? 'tuesday' :
                          dayOfWeek === 3 ? 'wednesday' :
                          dayOfWeek === 4 ? 'thursday' :
                          dayOfWeek === 5 ? 'friday' : 'saturday';
            
            state.weeklyTemplate[dayKey] = JSON.parse(JSON.stringify(tasks));
            
            saveState();
        }

        function migrateData() {
            if (state.tasks && state.tasks.monday) {
                const oldTasks = state.tasks;
                state.tasks = {};
                state.weeklyTemplate = JSON.parse(JSON.stringify(oldTasks));
                saveState();
            }
        }

        function loadState() {
            const raw = localStorage.getItem(STORAGE_KEY);
            if (raw) {
                try {
                    const parsed = JSON.parse(raw);
                    state = { ...state, ...parsed };
                } catch (e) {
                    console.warn('Error parsing saved data', e);
                }
            }
            migrateData();
        }

        function saveState() {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
        }

        // ========== FUNGSI ANIMASI ==========
        function setupScrollAnimations() {
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('visible');
                    }
                });
            }, { threshold: 0.1 });
            
            document.querySelectorAll('.fade-in, .slide-in-left, .slide-in-right').forEach(el => {
                observer.observe(el);
            });
        }

        function setupParallax() {
            const parallaxBg = document.querySelector('.parallax-bg');
            
            window.addEventListener('scroll', () => {
                const scrollY = window.scrollY;
                parallaxBg.style.transform = `translateY(${scrollY * 0.4}px) translateZ(-10px) scale(2)`;
            });
        }

        function setupMateriSlide() {
            const materiHalves = document.querySelectorAll('.materi-half');
            const materiContents = document.querySelectorAll('.materi-content');
            
            materiHalves.forEach(half => {
                half.addEventListener('click', () => {
                    const contentId = half.getAttribute('data-content');
                    
                    materiHalves.forEach(h => {
                        if (h === half) {
                            h.classList.add('active');
                            h.classList.remove('inactive');
                        } else {
                            h.classList.remove('active');
                            h.classList.add('inactive');
                        }
                    });
                    
                    materiContents.forEach(content => {
                        if (content.id === contentId) {
                            content.classList.add('active');
                            content.style.animation = 'slideIn 0.5s ease forwards';
                        } else {
                            content.classList.remove('active');
                        }
                    });
                });
            });
        }

        // ========== FUNGSI NAVIGASI ==========
        function setupNavigation() {
            document.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const page = link.getAttribute('data-page');
                    showPage(page);
                    
                    document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                    link.classList.add('active');
                    
                    document.getElementById('mobileMenu').classList.remove('open');
                    document.getElementById('menuOverlay').classList.remove('open');
                    document.body.style.overflow = '';
                });
            });
            
            document.getElementById('hamburger').addEventListener('click', () => {
                const menu = document.getElementById('mobileMenu');
                const overlay = document.getElementById('menuOverlay');
                menu.classList.toggle('open');
                overlay.classList.toggle('open');
                document.body.style.overflow = menu.classList.contains('open') ? 'hidden' : '';
            });
        }

        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            
            const pageElement = document.getElementById(`${pageId}-page`);
            if (pageElement) {
                pageElement.classList.add('active');
                
                switch(pageId) {
                    case 'home':
                        renderHomePage();
                        break;
                    case 'materi':
                        renderMateriPage();
                        break;
                    case 'absensi':
                        renderAbsensiPage();
                        break;
                    case 'settings':
                        renderSettingsPage();
                        break;
                }
            }
        }

        // ========== RENDER FUNCTIONS ==========
        function renderHomePage() {
            renderCalendar();
            renderToday();
            renderWeeklySummary();
        }

        function renderCalendar() {
            const calendarEl = document.getElementById('calendar');
            calendarEl.innerHTML = '';
            
            const today = new Date();
            const startOfWeek = new Date(today);
            startOfWeek.setDate(today.getDate() - today.getDay() + 1);
            
            for (let i = 0; i < 7; i++) {
                const currentDate = new Date(startOfWeek);
                currentDate.setDate(startOfWeek.getDate() + i);
                
                const dateStr = currentDate.toISOString().split('T')[0];
                const tasks = getTasksForDate(currentDate);
                
                const dayKey = Object.keys(DAY_LABEL)[i];
                const card = document.createElement('div');
                card.className = 'day-card fade-in';
                
                const isToday = currentDate.toDateString() === today.toDateString();
                const dateLabel = document.createElement('div');
                dateLabel.className = 'small';
                dateLabel.innerHTML = `<strong>${DAY_LABEL[dayKey]}</strong> - ${currentDate.getDate()}/${currentDate.getMonth() + 1}`;
                if (isToday) {
                    dateLabel.innerHTML += ' <span style="color:var(--accent)">(Hari Ini)</span>';
                }
                card.appendChild(dateLabel);
                
                Object.keys(SLOTS).forEach(slot => {
                    const arr = tasks[slot] || [];
                    const slotDiv = document.createElement('div');
                    slotDiv.className = 'slot';
                    
                    const left = document.createElement('div');
                    left.innerHTML = `<div class="pill">${SLOTS[slot].label}</div>`;
                    
                    const right = document.createElement('div');
                    if (arr.length === 0) {
                        right.innerHTML = `<span class="pill small">-- kosong --</span>`;
                    } else {
                        right.innerHTML = arr.map((t, i) => 
                            `<span class="pelajaran-badge" data-date="${dateStr}" data-slot="${slot}" data-idx="${i}">${t.title}</span>`
                        ).join(' ');
                    }
                    
                    slotDiv.appendChild(left);
                    slotDiv.appendChild(right);
                    card.appendChild(slotDiv);
                });
                
                const act = document.createElement('div');
                act.className = 'actions';
                const a1 = document.createElement('button');
                a1.className = 'btn';
                a1.innerText = 'Acak';
                a1.onclick = () => randomizeDay(currentDate);
                const a2 = document.createElement('button');
                a2.className = 'btn';
                a2.innerText = 'Lihat';
                a2.onclick = () => showDayDetails(currentDate);
                
                act.appendChild(a1);
                act.appendChild(a2);
                card.appendChild(act);
                calendarEl.appendChild(card);
            }
            
            document.querySelectorAll('.pelajaran-badge').forEach(el => {
                el.addEventListener('click', () => {
                    openEditTask(
                        el.dataset.date,
                        el.dataset.slot, 
                        parseInt(el.dataset.idx)
                    );
                });
            });
            
            setupScrollAnimations();
        }

        function renderToday() {
            const now = new Date();
            const todayDateEl = document.getElementById('today-date');
            todayDateEl.innerText = now.toLocaleDateString('id-ID', {
                weekday: 'long',
                day: 'numeric',
                month: 'long',
                year: 'numeric'
            });
            
            const todayTasksEl = document.getElementById('today-tasks');
            todayTasksEl.innerHTML = '';
            
            const tasks = getTasksForDate(now);
            
            Object.keys(SLOTS).forEach(slot => {
                const arr = tasks[slot] || [];
                
                if (arr.length === 0) {
                    const empty = document.createElement('div');
                    empty.className = 'task-item';
                    empty.innerHTML = `
                        <div class="task-left">
                            <div style="width:10px"></div>
                            <div>
                                <strong>${SLOTS[slot].label}</strong>
                                <div class="small">--</div>
                            </div>
                        </div>
                        <div><span class="small">Kosong</span></div>
                    `;
                    todayTasksEl.appendChild(empty);
                } else {
                    arr.forEach((t, i) => {
                        const dateStr = now.toISOString().split('T')[0];
                        const el = document.createElement('div');
                        el.className = 'task-item';
                        el.innerHTML = `
                            <div class="task-left">
                                <div style="width:8px;height:8px;border-radius:50%;background:${t.subject === 'Game' ? '#f59e0b' : (t.subject.includes('Matematika') ? '#60a5fa' : '#7c3aed')};"></div>
                                <div>
                                    <strong>${t.title}</strong>
                                    <div class="small">${t.subject} • ${t.duration} menit • pengingat ${t.remind}m</div>
                                </div>
                            </div>
                            <div style="display:flex;gap:6px;align-items:center">
                                <button class="btn" onclick="openEditTask('${dateStr}','${slot}',${i})">Edit</button>
                                <button class="btn danger" onclick="removeTask('${dateStr}','${slot}',${i})">Hapus</button>
                            </div>
                        `;
                        todayTasksEl.appendChild(el);
                    });
                }
            });
        }

        function renderWeeklySummary() {
            const weeklySummaryEl = document.getElementById('weekly-summary');
            weeklySummaryEl.innerHTML = '';
            
            let totalTasks = 0;
            let completedTasks = 0;
            
            const today = new Date();
            const startOfWeek = new Date(today);
            startOfWeek.setDate(today.getDate() - today.getDay() + 1);
            
            for (let i = 0; i < 7; i++) {
                const currentDate = new Date(startOfWeek);
                currentDate.setDate(startOfWeek.getDate() + i);
                const tasks = getTasksForDate(currentDate);
                
                Object.keys(SLOTS).forEach(slot => {
                    const tasksForSlot = tasks[slot] || [];
                    totalTasks += tasksForSlot.length;
                    
                    tasksForSlot.forEach(task => {
                        if (task.completed) completedTasks++;
                    });
                });
            }
            
            const progress = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;
            
            weeklySummaryEl.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                    <span class="small">Progress Mingguan</span>
                    <span class="small">${progress}%</span>
                </div>
                <div class="progress-container">
                    <div class="progress-bar" style="width: ${progress}%"></div>
                </div>
                <div style="display: flex; justify-content: space-between; margin-top: 8px;">
                    <span class="small">${completedTasks}/${totalTasks} kegiatan</span>
                </div>
            `;
        }

        function renderMateriPage() {
            const tkaContent = document.getElementById('tka-content');
            const midContent = document.getElementById('mid-content');
            
            tkaContent.innerHTML = '';
            midContent.innerHTML = '';
            
            Object.keys(TKA_MATERI).forEach(key => {
                const m = TKA_MATERI[key];
                const card = document.createElement('div');
                card.className = 'panel';
                card.style.marginBottom = '12px';
                card.innerHTML = `
                    <h4>${m.title}</h4>
                    <p class="small">${m.summary}</p>
                    <h5>Referensi</h5>
                    <ul class="ref-list">
                        ${(m.refs || []).map(r => `<li><a class="ref-link" href="${r.url}" target="_blank">${r.name}</a></li>`).join('')}
                    </ul>
                    ${m.examples && m.examples.length > 0 ? `
                        <h5>Contoh Soal</h5>
                        <ol>
                            ${m.examples.map(e => `<li><strong>Soal:</strong> ${e.q}<br/><em>Jawab:</em> ${e.a}</li>`).join('')}
                        </ol>
                    ` : ''}
                `;
                tkaContent.appendChild(card);
            });
            
            Object.keys(MID_MATERI).forEach(key => {
                const m = MID_MATERI[key];
                const card = document.createElement('div');
                card.className = 'panel';
                card.style.marginBottom = '12px';
                card.innerHTML = `
                    <h4>${m.title}</h4>
                    <p class="small">${m.summary}</p>
                    <h5>Referensi</h5>
                    <ul class="ref-list">
                        ${(m.refs || []).map(r => `<li><a class="ref-link" href="${r.url}" target="_blank">${r.name}</a></li>`).join('')}
                    </ul>
                    ${m.examples && m.examples.length > 0 ? `
                        <h5>Contoh Soal</h5>
                        <ol>
                            ${m.examples.map(e => `<li><strong>Soal:</strong> ${e.q}<br/><em>Jawab:</em> ${e.a}</li>`).join('')}
                        </ol>
                    ` : ''}
                `;
                midContent.appendChild(card);
            });
            
            setupMateriSlide();
            setupScrollAnimations();
        }

        function renderAbsensiPage() {
            const streakCount = document.getElementById('streak-count');
            const streakCircle = document.getElementById('streak-circle');
            const badgesContainer = document.getElementById('badges');
            const attendanceHistory = document.getElementById('attendance-history');
            
            streakCount.innerText = state.streak.count || 0;
            
            const streakPercentage = Math.min(100, (state.streak.count % 7) * 100 / 7);
            streakCircle.style.background = `conic-gradient(var(--accent) 0%, var(--accent-2) ${streakPercentage}%, rgba(255,255,255,0.1) ${streakPercentage}%)`;
            
            badgesContainer.innerHTML = '';
            BADGES.forEach(badge => {
                const hasBadge = state.streak.badges.includes(badge.id);
                const badgeEl = document.createElement('div');
                badgeEl.className = `badge ${hasBadge ? '' : 'locked'}`;
                badgeEl.innerHTML = `
                    <div style="font-size: 32px;">${badge.icon}</div>
                    <h4>${hasBadge ? badge.name : '???'}</h4>
                    <p class="small">${hasBadge ? badge.description : 'Kunci terbuka pada streak ' + badge.requiredStreak}</p>
                `;
                badgesContainer.appendChild(badgeEl);
            });
            
            // Render attendance history
            attendanceHistory.innerHTML = '';
            const today = new Date();
            for (let i = 29; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(today.getDate() - i);
                const dateStr = date.toISOString().split('T')[0];
                
                const dayEl = document.createElement('div');
                dayEl.className = 'history-day';
                dayEl.textContent = date.getDate();
                
                if (state.attendance[dateStr]) {
                    dayEl.classList.add('present');
                }
                
                attendanceHistory.appendChild(dayEl);
            }
            
            setupScrollAnimations();
        }

        function renderSettingsPage() {
            document.getElementById('toggle-notif-settings').checked = state.settings.notifications;
            document.getElementById('toggle-per-lesson-alarm').checked = state.settings.perLessonAlarm;
            document.getElementById('toggle-dark-mode').checked = state.settings.darkMode;
            document.getElementById('toggle-animations').checked = state.settings.animations;
            
            setupScrollAnimations();
        }

        function renderCalendarModal() {
            const monthYearEl = document.getElementById('calendar-month-year');
            const calendarDaysEl = document.getElementById('calendar-days');
            
            const current = state.currentCalendarView;
            const year = current.getFullYear();
            const month = current.getMonth();
            
            const monthNames = ["Januari", "Februari", "Maret", "April", "Mei", "Juni",
                                "Juli", "Agustus", "September", "Oktober", "November", "Desember"];
            monthYearEl.textContent = `${monthNames[month]} ${year}`;
            
            calendarDaysEl.innerHTML = '';
            
            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            
            for (let i = 0; i < firstDay; i++) {
                const emptyDay = document.createElement('div');
                emptyDay.className = 'calendar-day';
                calendarDaysEl.appendChild(emptyDay);
            }
            
            const today = new Date();
            for (let i = 1; i <= daysInMonth; i++) {
                const dayEl = document.createElement('div');
                dayEl.className = 'calendar-day';
                
                const date = new Date(year, month, i);
                const dateStr = date.toISOString().split('T')[0];
                
                if (i === today.getDate() && month === today.getMonth() && year === today.getFullYear()) {
                    dayEl.classList.add('current');
                }
                
                const tasks = getTasksForDate(date);
                let hasTasks = false;
                
                Object.keys(SLOTS).forEach(slot => {
                    if (tasks[slot] && tasks[slot].length > 0) {
                        hasTasks = true;
                    }
                });
                
                if (hasTasks) {
                    dayEl.classList.add('has-tasks');
                }
                
                dayEl.innerHTML = `
                    <div class="day-number">${i}</div>
                `;
                
                dayEl.addEventListener('click', () => {
                    showDayModal(year, month, i);
                });
                
                calendarDaysEl.appendChild(dayEl);
            }
        }

        function showDayModal(year, month, day) {
            const modalTitle = document.getElementById('day-modal-title');
            const modalContent = document.getElementById('day-modal-content');
            
            const date = new Date(year, month, day);
            modalTitle.textContent = `Kegiatan pada ${date.toLocaleDateString('id-ID', { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' })}`;
            
            const tasks = getTasksForDate(date);
            let hasTasks = false;
            let tasksHTML = '';
            
            Object.keys(SLOTS).forEach(slot => {
                const tasksForSlot = tasks[slot] || [];
                
                if (tasksForSlot.length > 0) {
                    hasTasks = true;
                    tasksHTML += `<h4>${SLOTS[slot].label}</h4>`;
                    
                    tasksForSlot.forEach((task, index) => {
                        tasksHTML += `
                            <div class="day-task-item">
                                <strong>${task.title}</strong> (${task.subject})<br>
                                <span class="small">Durasi: ${task.duration} menit</span>
                            </div>
                        `;
                    });
                }
            });
            
            if (hasTasks) {
                modalContent.innerHTML = tasksHTML;
            } else {
                modalContent.innerHTML = '<p>Tidak ada kegiatan yang dijadwalkan untuk hari ini.</p>';
            }
            
            document.getElementById('day-modal').style.display = 'flex';
        }

        // ========== TASK MANAGEMENT ==========
        function setupTaskModal() {
            const subjectSelect = document.getElementById('m-inp-subject');
            SUBJECTS.forEach(subject => {
                const option = document.createElement('option');
                option.value = subject;
                option.textContent = subject.startsWith('mid_') ? 
                    subject.replace('mid_', '(MID) ') : subject;
                subjectSelect.appendChild(option);
            });
            
            const daySelect = document.getElementById('m-inp-day');
            DAYS.forEach(day => {
                const option = document.createElement('option');
                option.value = day;
                option.textContent = DAY_LABEL[day];
                daySelect.appendChild(option);
            });
            
            document.getElementById('btn-add').addEventListener('click', openModalForNew);
            document.getElementById('m-cancel-task').addEventListener('click', closeModal);
            document.getElementById('m-save-task').addEventListener('click', saveTask);
            document.getElementById('task-modal-close').addEventListener('click', closeModal);
            
            document.getElementById('btn-clear').addEventListener('click', () => {
                if (confirm('Reset semua jadwal ke keadaan kosong?')) {
                    const today = new Date();
                    const startOfWeek = new Date(today);
                    startOfWeek.setDate(today.getDate() - today.getDay() + 1);
                    
                    for (let i = 0; i < 7; i++) {
                        const currentDate = new Date(startOfWeek);
                        currentDate.setDate(startOfWeek.getDate() + i);
                        const dateStr = currentDate.toISOString().split('T')[0];
                        
                        state.tasks[dateStr] = {
                            slot1: [], slot2: [], slot3: [], slot4: [], slot5: []
                        };
                    }
                    
                    saveState();
                    renderHomePage();
                }
            });
            
            document.getElementById('btn-view-today').addEventListener('click', () => {
                const today = new Date();
                showDayDetails(today);
            });
            
            document.getElementById('floating-btn').addEventListener('click', openModalForNew);
        }

        function openEditTask(dateStr, slot, index) {
            const tasks = getTasksForDate(new Date(dateStr));
            const task = tasks[slot][index];
            
            document.getElementById('m-inp-title').value = task.title;
            document.getElementById('m-inp-subject').value = task.subject;
            
            const date = new Date(dateStr);
            const dayOfWeek = date.getDay();
            const dayKey = dayOfWeek === 0 ? 'sunday' : 
                          dayOfWeek === 1 ? 'monday' :
                          dayOfWeek === 2 ? 'tuesday' :
                          dayOfWeek === 3 ? 'wednesday' :
                          dayOfWeek === 4 ? 'thursday' :
                          dayOfWeek === 5 ? 'friday' : 'saturday';
            
            document.getElementById('m-inp-day').value = dayKey;
            document.getElementById('m-inp-slot').value = slot;
            document.getElementById('m-inp-duration').value = task.duration;
            document.getElementById('m-inp-remind').value = task.remind;
            
            window.editingTask = { dateStr, slot, index };
            
            document.getElementById('taskModal').style.display = 'flex';
        }

        function openModalForNew() {
            document.getElementById('m-inp-title').value = '';
            document.getElementById('m-inp-subject').value = 'Matematika';
            document.getElementById('m-inp-duration').value = 60;
            document.getElementById('m-inp-remind').value = 10;
            
            window.editingTask = null;
            
            document.getElementById('taskModal').style.display = 'flex';
        }

        function closeModal() {
            document.getElementById('taskModal').style.display = 'none';
            document.getElementById('calendar-modal').style.display = 'none';
            document.getElementById('day-modal').style.display = 'none';
        }

        function saveTask() {
            const title = document.getElementById('m-inp-title').value.trim() || '(Tanpa Judul)';
            const subject = document.getElementById('m-inp-subject').value;
            const dayKey = document.getElementById('m-inp-day').value;
            const slot = document.getElementById('m-inp-slot').value;
            const duration = parseInt(document.getElementById('m-inp-duration').value) || 60;
            const remind = parseInt(document.getElementById('m-inp-remind').value) || 0;
            
            const task = {
                title,
                subject,
                duration,
                remind,
                createdAt: Date.now()
            };
            
            if (window.editingTask) {
                const { dateStr, slot, index } = window.editingTask;
                const tasks = getTasksForDate(new Date(dateStr));
                tasks[slot][index] = task;
                saveTasksForDate(new Date(dateStr), tasks);
                window.editingTask = null;
            } else {
                const today = new Date();
                const targetDate = new Date(today);
                
                const targetDayIndex = Object.keys(DAY_LABEL).indexOf(dayKey);
                const currentDayIndex = today.getDay() === 0 ? 6 : today.getDay() - 1;
                
                let daysToAdd = targetDayIndex - currentDayIndex;
                if (daysToAdd < 0) daysToAdd += 7;
                
                targetDate.setDate(today.getDate() + daysToAdd);
                
                const tasks = getTasksForDate(targetDate);
                if (!tasks[slot]) {
                    tasks[slot] = [];
                }
                
                tasks[slot].push(task);
                saveTasksForDate(targetDate, tasks);
            }
            
            saveState();
            renderHomePage();
            closeModal();
        }

        function removeTask(dateStr, slot, index) {
            if (confirm('Hapus kegiatan ini?')) {
                const tasks = getTasksForDate(new Date(dateStr));
                tasks[slot].splice(index, 1);
                saveTasksForDate(new Date(dateStr), tasks);
                saveState();
                renderHomePage();
            }
        }

        function randomizeDay(date) {
            const pool = ["Matematika", "Bahasa Indonesia", "Bahasa Inggris", "Sejarah", "PKN", "Tugas Film", "Ngoding", "Banner", "Game", "mid_matematika", "mid_bahasa_indonesia"];
            const tasks = getTasksForDate(date);
            
            Object.keys(SLOTS).forEach(slot => {
                const choice = pool[Math.floor(Math.random() * pool.length)];
                tasks[slot] = [{
                    title: (choice.startsWith('mid_') ? 'MID: ' + choice.replace('mid_', '') : choice) + (choice === 'Game' ? ' (Istirahat)' : ''),
                    subject: choice,
                    duration: choice === 'Game' ? 30 : 60,
                    remind: 10,
                    createdAt: Date.now()
                }];
            });
            
            saveTasksForDate(date, tasks);
            renderHomePage();
        }

        function showDayDetails(date) {
            const tasks = getTasksForDate(date);
            let details = `=== ${date.toLocaleDateString('id-ID', { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' })} ===\n\n`;
            
            Object.keys(SLOTS).forEach(slot => {
                const tasksForSlot = tasks[slot] || [];
                details += `${SLOTS[slot].label}:\n`;
                
                if (tasksForSlot.length === 0) {
                    details += "  - (kosong)\n";
                } else {
                    tasksForSlot.forEach(task => {
                        details += `  - ${task.title} (${task.subject}) [${task.duration}m]\n`;
                    });
                }
                details += "\n";
            });
            
            alert(details);
        }

        // ========== ATTENDANCE FUNCTIONS ==========
        function checkinToday() {
            const todayKey = new Date().toISOString().slice(0, 10);
            const last = state.streak.lastCheck;
            
            if (last === todayKey) {
                alert('Kamu sudah check-in hari ini 👍');
                return;
            }
            
            const yesterday = new Date();
            yesterday.setDate(yesterday.getDate() - 1);
            const yesterdayKey = yesterday.toISOString().slice(0, 10);
            
            if (last === yesterdayKey) {
                state.streak.count += 1;
            } else {
                state.streak.count = 1;
            }
            
            state.streak.lastCheck = todayKey;
            state.attendance[todayKey] = true;
            
            checkForNewBadges();
            createConfetti();
            
            saveState();
            renderAbsensiPage();
            alert('Check-in tercatat ✅');
        }

        function checkForNewBadges() {
            BADGES.forEach(badge => {
                if (!state.streak.badges.includes(badge.id) && state.streak.count >= badge.requiredStreak) {
                    state.streak.badges.push(badge.id);
                    alert(`Selamat! Kamu mendapatkan badge: ${badge.name}`);
                }
            });
        }

        function createConfetti() {
            const colors = ['#60a5fa', '#7c3aed', '#22c55e', '#f59e0b', '#ef4444'];
            
            for (let i = 0; i < 50; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * 100 + 'vw';
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.animation = `confetti-fall ${Math.random() * 3 + 2}s linear forwards`;
                
                document.body.appendChild(confetti);
                
                setTimeout(() => {
                    document.body.removeChild(confetti);
                }, 5000);
            }
        }

        // ========== EVENT LISTENERS ==========
        function setupEventListeners() {
            document.getElementById('btn-view-calendar').addEventListener('click', () => {
                renderCalendarModal();
                document.getElementById('calendar-modal').style.display = 'flex';
            });
            
            document.getElementById('calendar-modal-close').addEventListener('click', () => {
                document.getElementById('calendar-modal').style.display = 'none';
            });
            
            document.getElementById('calendar-prev').addEventListener('click', () => {
                const current = state.currentCalendarView;
                current.setMonth(current.getMonth() - 1);
                renderCalendarModal();
            });
            
            document.getElementById('calendar-next').addEventListener('click', () => {
                const current = state.currentCalendarView;
                current.setMonth(current.getMonth() + 1);
                renderCalendarModal();
            });
            
            document.getElementById('day-modal-close').addEventListener('click', () => {
                document.getElementById('day-modal').style.display = 'none';
            });
            
            document.getElementById('btn-checkin').addEventListener('click', checkinToday);
            
            document.getElementById('toggle-notif-settings').addEventListener('change', (e) => {
                state.settings.notifications = e.target.checked;
                saveState();
            });
            
            document.getElementById('toggle-per-lesson-alarm').addEventListener('change', (e) => {
                state.settings.perLessonAlarm = e.target.checked;
                saveState();
            });
            
            document.getElementById('toggle-dark-mode').addEventListener('change', (e) => {
                state.settings.darkMode = e.target.checked;
                saveState();
            });
            
            document.getElementById('toggle-animations').addEventListener('change', (e) => {
                state.settings.animations = e.target.checked;
                saveState();
            });
            
            document.getElementById('btn-export').addEventListener('click', exportData);
            document.getElementById('btn-import').addEventListener('click', importData);
            document.getElementById('btn-reset-all').addEventListener('click', resetData);
            
            setupTaskModal();
        }

        // ========== DATA MANAGEMENT ==========
        function exportData() {
            const data = JSON.stringify(state, null, 2);
            const blob = new Blob([data], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = 'tka_planner_backup.json';
            a.click();
            
            URL.revokeObjectURL(url);
        }

        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = e => {
                const file = e.target.files[0];
                const reader = new FileReader();
                
                reader.onload = event => {
                    try {
                        const importedState = JSON.parse(event.target.result);
                        state = { ...state, ...importedState };
                        saveState();
                        alert('Data berhasil diimpor!');
                        location.reload();
                    } catch (error) {
                        alert('Error mengimpor data: Format file tidak valid');
                    }
                };
                
                reader.readAsText(file);
            };
            
            input.click();
        }

        function resetData() {
            if (confirm('Apakah Anda yakin ingin menghapus semua data? Tindakan ini tidak dapat dibatalkan.')) {
                localStorage.removeItem(STORAGE_KEY);
                alert('Data telah direset. Halaman akan dimuat ulang.');
                location.reload();
            }
        }

        // ========== INITIALIZATION ==========
        function init() {
            loadState();
            setupNavigation();
            setupEventListeners();
            renderHomePage();
            setupScrollAnimations();
            setupParallax();
            
            const hamburger = document.getElementById('hamburger');
            const mobileMenu = document.getElementById('mobileMenu');
            const menuOverlay = document.getElementById('menuOverlay');
            
            hamburger.addEventListener('click', () => {
                mobileMenu.classList.toggle('open');
                menuOverlay.classList.toggle('open');
                document.body.style.overflow = mobileMenu.classList.contains('open') ? 'hidden' : '';
            });
            
            menuOverlay.addEventListener('click', () => {
                mobileMenu.classList.remove('open');
                menuOverlay.classList.remove('open');
                document.body.style.overflow = '';
            });
            
            const floatingBtn = document.getElementById('floating-btn');
            floatingBtn.addEventListener('click', () => {
                openModalForNew();
            });
        }

        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>