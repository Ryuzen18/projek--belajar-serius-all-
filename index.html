<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Planner TKA â€” Personal Study Scheduler (Updated)</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* ========== Reset & Base ========== */
        :root {
            --bg1: linear-gradient(135deg, #0f172a 0%, #0b1220 40%, #0b4a6f 100%);
            --card: rgba(255, 255, 255, 0.06);
            --glass: rgba(255, 255, 255, 0.04);
            --accent: #60a5fa;
            --accent-2: #7c3aed;
            --muted: rgba(255, 255, 255, 0.7);
            --success: #22c55e;
            --danger: #ef4444;
            --glass-border: rgba(255, 255, 255, 0.08);
            --transition: all 0.3s ease;
            font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
        }

        * {
            box-sizing: border-box;
        }

        html, body {
            height: 100%;
        }

        body {
            margin: 0;
            background: var(--bg1);
            color: #e6eef8;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            padding: 12px;
            display: flex;
            gap: 12px;
            align-items: flex-start;
            justify-content: center;
            min-height: 100vh;
        }

        /* ========== APP LAYOUT ========== */
        .app {
            width: 100%;
            max-width: 1100px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .page {
            display: none;
        }

        .page.active {
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
        }

        /* ========== NAVBAR ========== */
        .topbar {
            grid-column: 1/-1;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
            padding: 8px 0;
            position: relative;
            z-index: 100;
        }

        .brand {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .logo {
            width: 46px;
            height: 46px;
            border-radius: 12px;
            background: linear-gradient(135deg, var(--accent), var(--accent-2));
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 6px 20px rgba(124, 58, 237, 0.18);
            font-weight: 700;
            color: #fff;
            font-size: 18px;
        }

        .nav {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .nav a {
            color: var(--muted);
            text-decoration: none;
            padding: 8px 10px;
            border-radius: 8px;
            transition: var(--transition);
        }

        .nav a.active {
            background: rgba(255, 255, 255, 0.03);
            color: #fff;
        }

        .nav a:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .hamburger {
            display: none;
            border: 0;
            background: transparent;
            color: var(--muted);
            font-size: 20px;
            cursor: pointer;
        }

        /* Mobile menu styles */
        .mobile-menu {
            display: none;
            position: absolute;
            top: 100%;
            right: 0;
            width: 200px;
            background: linear-gradient(180deg, rgba(255, 255, 255, 0.08), rgba(255, 255, 255, 0.04));
            border-radius: 8px;
            padding: 10px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
        }

        .mobile-menu.open {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        .mobile-menu a {
            display: block;
            color: var(--muted);
            text-decoration: none;
            padding: 10px;
            border-radius: 6px;
            transition: var(--transition);
        }

        .mobile-menu a:hover, .mobile-menu a.active {
            background: rgba(255, 255, 255, 0.05);
            color: #fff;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @media (max-width: 900px) {
            .nav {
                display: none;
            }
            .hamburger {
                display: block;
            }
        }

        /* ========== Panels ========== */
        .panel {
            background: linear-gradient(180deg, rgba(255, 255, 255, 0.02), rgba(255, 255, 255, 0.01));
            border-radius: 14px;
            padding: 14px;
            border: 1px solid var(--glass-border);
            box-shadow: 0 6px 30px rgba(2, 6, 23, 0.6);
            transition: var(--transition);
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        @media (max-width: 600px) {
            .calendar-grid {
                grid-template-columns: 1fr;
            }
        }

        .day-card {
            background: var(--card);
            border-radius: 10px;
            padding: 10px;
            min-height: 180px;
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.03);
        }

        .slot {
            display: flex;
            justify-content: space-between;
            margin-top: 8px;
            align-items: center;
            gap: 8px;
        }

        .pill {
            padding: 6px 8px;
            border-radius: 8px;
            font-size: 13px;
            background: linear-gradient(90deg, rgba(255, 255, 255, 0.03), rgba(255, 255, 255, 0.01));
            border: 1px solid rgba(255, 255, 255, 0.02);
        }

        .pelajaran-badge {
            padding: 6px 8px;
            border-radius: 10px;
            font-weight: 600;
            background: linear-gradient(90deg, var(--accent), var(--accent-2));
            color: #04233a;
            box-shadow: 0 6px 18px rgba(96, 165, 250, 0.14);
            cursor: pointer;
            transition: var(--transition);
        }

        .pelajaran-badge:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(96, 165, 250, 0.25);
        }

        .actions {
            display: flex;
            gap: 8px;
            margin-top: 10px;
        }

        .btn {
            border: 0;
            padding: 8px 10px;
            border-radius: 10px;
            font-weight: 600;
            background: var(--glass);
            color: var(--muted);
            cursor: pointer;
            border: 1px solid rgba(255, 255, 255, 0.03);
            transition: var(--transition);
        }

        .btn:hover {
            background: rgba(255, 255, 255, 0.08);
        }

        .btn.primary {
            background: linear-gradient(90deg, var(--accent), var(--accent-2));
            color: #052034;
        }

        .btn.primary:hover {
            background: linear-gradient(90deg, var(--accent), #4f86e8);
            box-shadow: 0 6px 18px rgba(96, 165, 250, 0.25);
        }

        .btn.danger {
            background: rgba(239, 68, 68, 0.9);
            color: #fff;
        }

        .btn.danger:hover {
            background: rgba(220, 60, 60, 0.9);
        }

        /* sidebar */
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .today-view {
            padding: 12px;
            border-radius: 12px;
            background: var(--glass);
            border: 1px solid var(--glass-border);
        }

        .task-item {
            display: flex;
            gap: 8px;
            align-items: center;
            justify-content: space-between;
            padding: 8px;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.02);
            margin-bottom: 8px;
            transition: var(--transition);
        }

        .task-item:hover {
            background: rgba(255, 255, 255, 0.04);
        }

        .small {
            font-size: 12px;
            color: var(--muted);
        }

        /* inputs */
        .input, select, textarea {
            padding: 8px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.06);
            background: rgba(255, 255, 255, 0.03);
            color: inherit;
            outline: none;
            width: 100%;
            transition: var(--transition);
        }

        .input:focus, select:focus, textarea:focus {
            border-color: var(--accent);
            box-shadow: 0 0 0 2px rgba(96, 165, 250, 0.2);
        }

        label {
            font-size: 12px;
            color: var(--muted);
            display: block;
            margin-bottom: 6px;
        }

        /* Materi Page Specific Styles */
        .materi-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .materi-split-view {
            display: flex;
            width: 100%;
            height: 200px;
            border-radius: 14px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(2, 6, 23, 0.7);
        }

        .materi-half {
            flex: 1;
            padding: 20px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            cursor: pointer;
            transition: all 0.5s cubic-bezier(0.25, 0.8, 0.25, 1);
            position: relative;
            overflow: hidden;
        }

        .materi-half.tka {
            background: linear-gradient(135deg, rgba(96, 165, 250, 0.15), rgba(76, 145, 240, 0.1));
            border-right: 1px solid var(--glass-border);
        }

        .materi-half.mid {
            background: linear-gradient(135deg, rgba(124, 58, 237, 0.15), rgba(104, 48, 217, 0.1));
        }

        .materi-half.active {
            flex: 4;
            z-index: 2;
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.4);
        }

        .materi-half.inactive {
            flex: 1;
            opacity: 0.8;
            filter: blur(1px);
        }

        .materi-half h2 {
            font-size: 24px;
            margin: 0 0 10px 0;
            transition: var(--transition);
        }

        .materi-half.active h2 {
            font-size: 28px;
        }

        .materi-content {
            display: none;
            padding: 20px;
            background: var(--card);
            border-radius: 14px;
            margin-top: 12px;
            border: 1px solid var(--glass-border);
            animation: fadeIn 0.5s ease;
        }

        .materi-content.active {
            display: block;
        }

        /* Absensi Page Specific Styles */
        .absensi-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .streak-container {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 20px;
            padding: 20px;
            background: var(--card);
            border-radius: 14px;
            border: 1px solid var(--glass-border);
        }

        .streak-visual {
            position: relative;
            width: 120px;
            height: 120px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .streak-circle {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: conic-gradient(var(--accent) 0%, var(--accent-2) 50%, rgba(255, 255, 255, 0.1) 0%);
            position: absolute;
        }

        .streak-count {
            font-size: 32px;
            font-weight: 800;
            color: var(--accent);
            z-index: 2;
        }

        .badges-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 12px;
            margin-top: 20px;
        }

        .badge {
            background: var(--card);
            border-radius: 10px;
            padding: 12px;
            text-align: center;
            border: 1px solid var(--glass-border);
            transition: var(--transition);
        }

        .badge:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }

        .badge.locked {
            filter: grayscale(1);
            opacity: 0.6;
        }

        /* Settings Page Specific Styles */
        .settings-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .settings-group {
            margin-bottom: 20px;
            padding: 15px;
            background: var(--card);
            border-radius: 14px;
            border: 1px solid var(--glass-border);
        }

        .settings-group h3 {
            margin-top: 0;
            border-bottom: 1px solid var(--glass-border);
            padding-bottom: 10px;
        }

        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .setting-item:last-child {
            border-bottom: none;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(255, 255, 255, 0.1);
            transition: .4s;
            border-radius: 24px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: var(--accent);
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        /* Calendar View Styles */
        .calendar-view {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
            margin-top: 16px;
        }

        .calendar-day {
            background: var(--card);
            border-radius: 8px;
            padding: 10px;
            min-height: 120px;
            border: 1px solid var(--glass-border);
            cursor: pointer;
            transition: var(--transition);
        }

        .calendar-day:hover {
            background: rgba(255, 255, 255, 0.08);
        }

        .calendar-day.current {
            border: 2px solid var(--accent);
        }

        .calendar-day.has-tasks {
            background: linear-gradient(135deg, rgba(96, 165, 250, 0.15), rgba(76, 145, 240, 0.1));
        }

        .day-number {
            font-weight: bold;
            margin-bottom: 8px;
            text-align: center;
        }

        .day-tasks {
            font-size: 12px;
            max-height: 80px;
            overflow-y: auto;
        }

        .day-task-item {
            padding: 4px;
            border-radius: 4px;
            background: rgba(255, 255, 255, 0.05);
            margin-bottom: 4px;
        }

        .calendar-header {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
            text-align: center;
            margin-bottom: 8px;
            font-weight: bold;
        }

        .calendar-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: var(--card);
            border-radius: 14px;
            padding: 20px;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
            border: 1px solid var(--glass-border);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--muted);
            font-size: 24px;
            cursor: pointer;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .materi-split-view {
                flex-direction: column;
                height: auto;
            }
            
            .materi-half {
                min-height: 100px;
            }
            
            .materi-half.active {
                min-height: 300px;
            }
            
            .calendar-view {
                grid-template-columns: repeat(7, 1fr);
                gap: 4px;
            }
            
            .calendar-day {
                min-height: 80px;
                padding: 6px;
            }
            
            .day-tasks {
                display: none;
            }
            
            .streak-container {
                flex-direction: column;
                text-align: center;
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 8px;
            }
            
            .logo {
                width: 40px;
                height: 40px;
            }
            
            .calendar-view {
                grid-template-columns: repeat(7, 1fr);
            }
            
            .calendar-day {
                min-height: 60px;
                font-size: 12px;
            }
            
            .day-number {
                font-size: 14px;
            }
        }

        /* Animation for the curtain effect */
        @keyframes curtainOpen {
            from {
                transform: scaleX(0);
                opacity: 0;
            }
            to {
                transform: scaleX(1);
                opacity: 1;
            }
        }

        .curtain-open {
            animation: curtainOpen 0.5s ease forwards;
            transform-origin: left;
        }

        /* Ref list styles */
        .ref-list {
            padding-left: 20px;
        }

        .ref-list li {
            margin-bottom: 8px;
        }

        a.ref-link {
            color: var(--accent);
            text-decoration: none;
            font-weight: 600;
        }

        a.ref-link:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="app">
        <div class="topbar">
            <div class="brand">
                <div class="logo">Ry</div>
                <div>
                    <h1 style="margin:0;font-size:16px">Web Belajar â€” Personal</h1>
                    <p class="small" style="margin:0">Kalender belajar â€¢ Materi TKA & Mid-semester â€¢ Absensi</p>
                </div>
            </div>

            <div>
                <nav class="nav">
                    <a href="#home" class="nav-link active" data-page="home">Home</a>
                    <a href="#materi" class="nav-link" data-page="materi">Materi</a>
                    <a href="#absensi" class="nav-link" data-page="absensi">Absensi</a>
                    <a href="#settings" class="nav-link" data-page="settings">Pengaturan</a>
                </nav>
                <button class="hamburger" id="hamburger">â˜°</button>
                
                <div class="mobile-menu" id="mobileMenu">
                    <a href="#home" class="nav-link active" data-page="home">Home</a>
                    <a href="#materi" class="nav-link" data-page="materi">Materi</a>
                    <a href="#absensi" class="nav-link" data-page="absensi">Absensi</a>
                    <a href="#settings" class="nav-link" data-page="settings">Pengaturan</a>
                </div>
            </div>
        </div>

        <!-- Home Page -->
        <div id="home-page" class="page active">
            <section class="panel fade-in">
                <h2 style="margin:0 0 8px 0">Kalender Mingguan</h2>
                <p class="small">Jadwal belajar baru: Pagi (09:00-11:00), Malam (18:30-23:00). Klik tugas untuk edit.</p>
                
                <div class="schedule-info panel">
                    <h4 style="margin:0 0 8px 0">Jadwal Belajar Baru</h4>
                    <div class="time-slot">
                        <span>Pagi</span>
                        <span>09:00 - 11:00</span>
                    </div>
                    <div class="time-slot">
                        <span>Istirahat</span>
                        <span>11:00 - 12:00</span>
                    </div>
                    <div class="time-slot">
                        <span>Sekolah</span>
                        <span>12:00 - 17:00</span>
                    </div>
                    <div class="time-slot">
                        <span>Istirahat & Makan Malam</span>
                        <span>17:00 - 18:30</span>
                    </div>
                    <div class="time-slot">
                        <span>Malam</span>
                        <span>18:30 - 23:00+</span>
                    </div>
                </div>

                <div id="calendar" class="calendar-grid" style="margin-top:12px"></div>

                <div style="margin-top:12px;display:flex;gap:8px;flex-wrap:wrap">
                    <button id="btn-add" class="btn">Tambah Kegiatan</button>
                    <button id="btn-clear" class="btn danger">Reset Semua</button>
                    <button id="btn-view-calendar" class="btn primary">Lihat Kalender Bulanan</button>
                </div>

            
            </section>

            <aside class="sidebar">
                <div class="panel today-view fade-in">
                    <h3>Hari Ini â€” <span id="today-date"></span></h3>
                    <div id="today-tasks" style="margin-top:8px"></div>

                    <div style="margin-top:8px">
                        <label><input type="checkbox" id="toggle-notif"> Izinkan notifikasi pengingat</label>
                    </div>

                    <div style="margin-top:8px" class="controls">
                        <button id="btn-view-today" class="btn primary">Lihat Rinci Hari Ini</button>
                    </div>
                </div>

                <div class="panel fade-in">
                    <h4>Progress Mingguan</h4>
                    <p class="small">Ringkasan kegiatan yang sudah direncanakan minggu ini.</p>
                    <div id="weekly-summary" style="margin-top:8px"></div>
                </div>
            </aside>
        </div>

        <!-- Materi Page -->
        <div id="materi-page" class="page">
            <div class="materi-container">
                <div class="panel">
                    <h2 style="margin:0 0 8px 0">Materi & Referensi Kelas 12</h2>
                    <p class="small">Pilih kategori: TKA (materi resmi) atau Mid-semester (mapel SMK Kelas 12).</p>
                </div>

                <div class="materi-split-view">
                    <div class="materi-half tka active" data-content="tka-content">
                        <h2>TKA</h2>
                        <p>Materi resmi Tes Kompetensi Akademik</p>
                    </div>
                    <div class="materi-half mid" data-content="mid-content">
                        <h2>Mid-semester</h2>
                        <p>Materi untuk ujian mid semester SMK</p>
                    </div>
                </div>

                <div id="tka-content" class="materi-content active">
                    <!-- TKA content will be injected here -->
                </div>

                <div id="mid-content" class="materi-content">
                    <!-- Mid-semester content will be injected here -->
                </div>
            </div>
        </div>

        <!-- Absensi Page -->
        <div id="absensi-page" class="page">
            <div class="absensi-container">
                <div class="panel">
                    <h2 style="margin:0 0 8px 0">Absensi & Streak</h2>
                    <p class="small">Catat kehadiran belajar harian, lihat streak, dan dapatkan badge.</p>
                </div>

                <div class="panel streak-container">
                    <div class="streak-visual">
                        <div class="streak-circle" id="streak-circle"></div>
                        <div class="streak-count" id="streak-count">0</div>
                    </div>
                    <div style="flex:1">
                        <h3 style="margin-top:0">Streak Belajar</h3>
                        <p class="small">Konsistensi adalah kunci kesuksesan. Check-in setiap hari untuk membangun streak dan mendapatkan penghargaan.</p>
                        <button id="btn-checkin" class="btn primary">Check-in Hari Ini</button>
                    </div>
                </div>

                <div class="panel">
                    <h4>Badges & Penghargaan</h4>
                    <p class="small">Kumpulkan badge dengan menyelesaikan tantangan belajar.</p>
                    
                    <div class="badges-container" id="badges">
                        <!-- Badges will be injected here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings Page -->
        <div id="settings-page" class="page">
            <div class="settings-container">
                <div class="panel">
                    <h2 style="margin:0 0 8px 0">Pengaturan</h2>
                    <p class="small">Kelola preferensi dan pengaturan aplikasi.</p>
                </div>

                <div class="panel settings-group">
                    <h3>Notifikasi</h3>
                    
                    <div class="setting-item">
                        <div>
                            <label>Notifikasi Pengingat</label>
                            <p class="small">Aktifkan notifikasi untuk jadwal belajar</p>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="toggle-notif-settings">
                            <span class="slider"></span>
                        </label>
                    </div>
                    
                    <div class="setting-item">
                        <div>
                            <label>Alarm per Pelajaran</label>
                            <p class="small">Bunyikan alarm saat membuka setiap pelajaran</p>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="toggle-per-lesson-alarm">
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>

                <div class="panel settings-group">
                    <h3>Tampilan</h3>
                    
                    <div class="setting-item">
                        <div>
                            <label>Mode Gelap</label>
                            <p class="small">Gunakan tema gelap untuk mengurangi ketegangan mata</p>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="toggle-dark-mode" checked>
                            <span class="slider"></span>
                        </label>
                    </div>
                    
                    <div class="setting-item">
                        <div>
                            <label>Animasi</label>
                            <p class="small">Aktifkan efek animasi dan transisi</p>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="toggle-animations" checked>
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>

                <div class="panel settings-group">
                    <h3>Data</h3>
                    
                    <div class="setting-item">
                        <div>
                            <label>Ekspor Data</label>
                            <p class="small">Simpan cadangan data jadwal dan progress</p>
                        </div>
                        <button id="btn-export" class="btn primary">Ekspor</button>
                    </div>
                    
                    <div class="setting-item">
                        <div>
                            <label>Impor Data</label>
                            <p class="small">Muat data dari file cadangan</p>
                        </div>
                        <button id="btn-import" class="btn">Impor</button>
                    </div>
                    
                    <div class="setting-item">
                        <div>
                            <label>Reset Data</label>
                            <p class="small">Hapus semua data dan kembali ke pengaturan awal</p>
                        </div>
                        <button id="btn-reset-all" class="btn danger">Reset</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Calendar Modal -->
        <div id="calendar-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="calendar-modal-title">Kalender Bulanan</h3>
                    <button class="modal-close" id="calendar-modal-close">&times;</button>
                </div>
                <div class="calendar-nav">
                    <button id="calendar-prev" class="btn"><i class="fas fa-chevron-left"></i></button>
                    <h4 id="calendar-month-year">Mei 2023</h4>
                    <button id="calendar-next" class="btn"><i class="fas fa-chevron-right"></i></button>
                </div>
                <div class="calendar-header">
                    <div>Min</div>
                    <div>Sen</div>
                    <div>Sel</div>
                    <div>Rab</div>
                    <div>Kam</div>
                    <div>Jum</div>
                    <div>Sab</div>
                </div>
                <div id="calendar-days" class="calendar-view">
                    <!-- Calendar days will be injected here -->
                </div>
            </div>
        </div>

        <!-- Day Detail Modal -->
        <div id="day-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="day-modal-title">Detail Hari</h3>
                    <button class="modal-close" id="day-modal-close">&times;</button>
                </div>
                <div id="day-modal-content">
                    <!-- Day details will be injected here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Form for Adding/Editing Tasks -->
    <div id="taskModal" style="position:fixed;left:0;right:0;bottom:0;top:0;display:none;background:linear-gradient(180deg, rgba(2,6,23,0.6), rgba(2,6,23,0.9));z-index:9999;">
        <div style="max-width:520px;margin:40px auto;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:12px;padding:12px;border:1px solid rgba(255,255,255,0.04);">
            <h4 id="modalTitle">Tambah / Edit Kegiatan</h4>
            <div style="max-height:60vh;overflow:auto;padding-right:8px">
                <label>Judul Kegiatan</label><input id="m-inp-title" class="input" placeholder="Contoh: Belajar Matematika (Trigonometri)">
                <label>Pelajaran / Tag</label>
                <select id="m-inp-subject" class="input"></select>
                <div style="display:flex;gap:8px;margin-top:8px">
                    <div style="flex:1"><label>Hari</label><select id="m-inp-day" class="input"></select></div>
                    <div style="flex:1"><label>Slot</label>
                        <select id="m-inp-slot" class="input">
                            <option value="slot1">09:00 - 10:00</option>
                            <option value="slot2">10:00 - 11:00</option>
                            <option value="slot3">18:30 - 20:00</option>
                            <option value="slot4">20:15 - 21:45</option>
                            <option value="slot5">22:00 - 23:00</option>
                        </select>
                    </div>
                </div>
                <div style="display:flex;gap:8px;margin-top:8px">
                    <div style="flex:1"><label>Durasi (menit)</label><input id="m-inp-duration" type="number" class="input" value="60" min="5"></div>
                    <div style="flex:1"><label>Pengingat (menit sebelum)</label><input id="m-inp-remind" type="number" class="input" value="10" min="0"></div>
                </div>
            </div>
            <div style="display:flex;gap:8px;margin-top:10px;justify-content:flex-end">
                <button id="m-save-task" class="btn primary">Simpan</button>
                <button id="m-cancel-task" class="btn">Batal</button>
            </div>
        </div>
    </div>

    <script>
        // Data and state management
        const SUBJECTS = [
            "Matematika", "Bahasa Indonesia", "Bahasa Inggris", "Sejarah", "PKN",
            "Tugas Film", "Ngoding", "Banner", "Game",
            "mid_matematika", "mid_bahasa_indonesia", "mid_bahasa_inggris", "mid_dkv", 
            "mid_desain_media_interaktif", "mid_pkk", "mid_kimia", "mid_fisika", 
            "mid_agama", "mid_ppkn", "mid_sejarah", "mid_ke-nu"
        ];

        const SLOTS = {
            slot1: { label: '09:00 - 10:00' },
            slot2: { label: '10:00 - 11:00' },
            slot3: { label: '18:30 - 20:00' },
            slot4: { label: '20:15 - 21:45' },
            slot5: { label: '22:00 - 23:00' }
        };

        const DAYS = ["monday", "tuesday", "wednesday", "thursday", "friday", "saturday", "sunday"];
        const DAY_LABEL = { 
            monday: 'Senin', tuesday: 'Selasa', wednesday: 'Rabu', thursday: 'Kamis', 
            friday: 'Jumat', saturday: 'Sabtu', sunday: 'Minggu' 
        };

        const STORAGE_KEY = "tka_planner_v3";
        let state = { 
            tasks: {}, 
            attendance: {}, 
            settings: { 
                notifications: false, 
                perLessonAlarm: false,
                darkMode: true,
                animations: true
            }, 
            streak: {
                count: 0,
                lastCheck: null,
                badges: []
            },
            currentCalendarView: new Date()
        };

        // Materi data
        const TKA_MATERI = {
            "Matematika": {
                title: "Matematika (TKA) â€” Kisi & Topik Utama Kelas 12",
                summary: "Bilangan, Aljabar, Fungsi, Geometri & Trigonometri, Data & Peluang, Statistika, Barisan & Deret, Limit, Turunan, Integral. Latihan cepat & pemahaman konsep sesuai kisi TKA.",
                refs: [
                    { name: "Pusmendik - Matematika (TKA)", url: "https://pusmendik.kemdikbud.go.id/tka/tka/view/mata-pelajaran-wajib/sma/matematika" },
                    { name: "Khan Academy (Kalkulus)", url: "https://id.khanacademy.org/math/calculus-1" },
                    { name: "Ruang Guru - Matematika Peminatan", url: "https://www.ruangguru.com/blog/matematika-peminatan-kelas-12" }
                ],
                examples: [
                    { q: "Jika f(x)=2x^2 âˆ’3x +1, cari f(2).", a: "3" },
                    { q: "Selesaikan: 2x+5=13", a: "x=4" }
                ]
            },
            "Bahasa Indonesia": {
                title: "Bahasa Indonesia â€” TKA Kelas 12",
                summary: "Pemahaman bacaan, teks fungsional, kosakata, struktur teks, menulis essay, proposal, karya ilmiah. Fokus soal analisis wacana & ide pokok.",
                refs: [
                    { name: "Pusmendik - Bahasa Indonesia", url: "https://pusmendik.kemdikbud.go.id/tka/tka/view/mata-pelajaran-wajib/sma/bahasa-indonesia" },
                    { name: "KBBI Online", url: "https://kbbi.kemdikbud.go.id" },
                    { name: "Ruang Guru - Bahasa Indonesia Kelas 12", url: "https://www.ruangguru.com/blog/bahasa-indonesia-kelas-12" }
                ],
                examples: [
                    { q: "Apa ide pokok paragraf?", a: "(contoh jawaban)" }
                ]
            }
        };

        const MID_MATERI = {
            "mid_matematika": { 
                title: "Matematika (Mid) Kelas 12", 
                summary: "Kisi-kisi mid: aljabar, trigonometri terapan, statistika dasar, limit, turunan, integral.",
                refs: [
                    { name: 'Ruang Guru - Matematika SMK Kelas 12', url: 'https://www.ruangguru.com/blog/matematika-smk-kelas-12' }
                ],
                examples: [
                    { q: 'Selesaikan: 3x-4=11', a: 'x=5' }
                ]
            },
            "mid_bahasa_indonesia": { 
                title: "Bahasa Indonesia (Mid) Kelas 12", 
                summary: "Menulis esai pendek, ringkasan, identifikasi ide pokok, proposal, laporan, karya ilmiah sederhana.",
                refs: [
                    { name: 'Ruang Guru - Bahasa Indonesia SMK Kelas 12', url: 'https://www.ruangguru.com/blog/bahasa-indonesia-smk-kelas-12' }
                ],
                examples: [
                    { q: 'Ringkas paragraf berikut...', a: '(jawaban contoh)' }
                ]
            }
        };

        const BADGES = [
            { id: 1, name: "Pemula", description: "Check-in pertama", requiredStreak: 1, icon: "ðŸ¥‰" },
            { id: 2, name: "Konsisten", description: "Check-in 7 hari berturut-turut", requiredStreak: 7, icon: "ðŸ¥ˆ" },
            { id: 3, name: "Ahli", description: "Check-in 30 hari berturut-turut", requiredStreak: 30, icon: "ðŸ¥‡" }
        ];

        // Initialize the application
        function init() {
            loadState();
            setupNavigation();
            setupEventListeners();
            renderHomePage();
            updateActiveNav();
        }

        // Load and save state
        function loadState() {
            const raw = localStorage.getItem(STORAGE_KEY);
            if (raw) {
                try {
                    const parsed = JSON.parse(raw);
                    state = { ...state, ...parsed };
                    
                    // Initialize tasks for each day if not exists
                    DAYS.forEach(d => {
                        if (!state.tasks[d]) {
                            state.tasks[d] = { 
                                slot1: [], slot2: [], slot3: [], slot4: [], slot5: [] 
                            };
                        }
                    });
                } catch (e) {
                    console.warn('Error parsing saved data', e);
                }
            }
        }

        function saveState() {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
        }

        // Navigation
        function setupNavigation() {
            // Handle nav link clicks
            document.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const page = link.getAttribute('data-page');
                    showPage(page);
                    
                    // Update active state
                    document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                    link.classList.add('active');
                    
                    // Close mobile menu if open
                    document.getElementById('mobileMenu').classList.remove('open');
                });
            });
            
            // Handle hamburger menu
            document.getElementById('hamburger').addEventListener('click', () => {
                const menu = document.getElementById('mobileMenu');
                menu.classList.toggle('open');
            });
        }

        function showPage(pageId) {
            // Hide all pages
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            
            // Show selected page
            const pageElement = document.getElementById(`${pageId}-page`);
            if (pageElement) {
                pageElement.classList.add('active');
                
                // Render page-specific content
                switch(pageId) {
                    case 'home':
                        renderHomePage();
                        break;
                    case 'materi':
                        renderMateriPage();
                        break;
                    case 'absensi':
                        renderAbsensiPage();
                        break;
                    case 'settings':
                        renderSettingsPage();
                        break;
                }
            }
        }

        function updateActiveNav() {
            const currentPage = document.querySelector('.page.active').id.replace('-page', '');
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('data-page') === currentPage) {
                    link.classList.add('active');
                }
            });
        }

        // Event listeners
        function setupEventListeners() {
            // Calendar modal
            document.getElementById('btn-view-calendar').addEventListener('click', () => {
                renderCalendarModal();
                document.getElementById('calendar-modal').style.display = 'flex';
            });
            
            document.getElementById('calendar-modal-close').addEventListener('click', () => {
                document.getElementById('calendar-modal').style.display = 'none';
            });
            
            document.getElementById('calendar-prev').addEventListener('click', () => {
                const current = state.currentCalendarView;
                current.setMonth(current.getMonth() - 1);
                renderCalendarModal();
            });
            
            document.getElementById('calendar-next').addEventListener('click', () => {
                const current = state.currentCalendarView;
                current.setMonth(current.getMonth() + 1);
                renderCalendarModal();
            });
            
            // Day modal close
            document.getElementById('day-modal-close').addEventListener('click', () => {
                document.getElementById('day-modal').style.display = 'none';
            });
            
            // Check-in button
            document.getElementById('btn-checkin').addEventListener('click', checkinToday);
            
            // Settings toggles
            document.getElementById('toggle-notif-settings').addEventListener('change', (e) => {
                state.settings.notifications = e.target.checked;
                saveState();
            });
            
            document.getElementById('toggle-per-lesson-alarm').addEventListener('change', (e) => {
                state.settings.perLessonAlarm = e.target.checked;
                saveState();
            });
            
            document.getElementById('toggle-dark-mode').addEventListener('change', (e) => {
                state.settings.darkMode = e.target.checked;
                saveState();
                applyTheme();
            });
            
            document.getElementById('toggle-animations').addEventListener('change', (e) => {
                state.settings.animations = e.target.checked;
                saveState();
            });
            
            // Data buttons
            document.getElementById('btn-export').addEventListener('click', exportData);
            document.getElementById('btn-import').addEventListener('click', importData);
            document.getElementById('btn-reset-all').addEventListener('click', resetData);
            
            // Task modal (existing functionality)
            setupTaskModal();
        }

        // Page rendering functions
        function renderHomePage() {
            renderCalendar();
            renderToday();
            renderWeeklySummary();
        }

        function renderMateriPage() {
            const tkaContent = document.getElementById('tka-content');
            const midContent = document.getElementById('mid-content');
            
            tkaContent.innerHTML = '';
            midContent.innerHTML = '';
            
            // Render TKA content
            Object.keys(TKA_MATERI).forEach(key => {
                const m = TKA_MATERI[key];
                const card = document.createElement('div');
                card.className = 'panel';
                card.style.marginBottom = '12px';
                card.innerHTML = `
                    <h4>${m.title}</h4>
                    <p class="small">${m.summary}</p>
                    <h5>Referensi</h5>
                    <ul class="ref-list">
                        ${(m.refs || []).map(r => `<li><a class="ref-link" href="${r.url}" target="_blank">${r.name}</a></li>`).join('')}
                    </ul>
                    ${m.examples && m.examples.length > 0 ? `
                        <h5>Contoh Soal</h5>
                        <ol>
                            ${m.examples.map(e => `<li><strong>Soal:</strong> ${e.q}<br/><em>Jawab:</em> ${e.a}</li>`).join('')}
                        </ol>
                    ` : ''}
                `;
                tkaContent.appendChild(card);
            });
            
            // Render Mid-semester content
            Object.keys(MID_MATERI).forEach(key => {
                const m = MID_MATERI[key];
                const card = document.createElement('div');
                card.className = 'panel';
                card.style.marginBottom = '12px';
                card.innerHTML = `
                    <h4>${m.title}</h4>
                    <p class="small">${m.summary}</p>
                    <h5>Referensi</h5>
                    <ul class="ref-list">
                        ${(m.refs || []).map(r => `<li><a class="ref-link" href="${r.url}" target="_blank">${r.name}</a></li>`).join('')}
                    </ul>
                    ${m.examples && m.examples.length > 0 ? `
                        <h5>Contoh Soal</h5>
                        <ol>
                            ${m.examples.map(e => `<li><strong>Soal:</strong> ${e.q}<br/><em>Jawab:</em> ${e.a}</li>`).join('')}
                        </ol>
                    ` : ''}
                `;
                midContent.appendChild(card);
            });
            
            // Setup materi tab animations
            setupMateriTabs();
        }

        function setupMateriTabs() {
            const materiHalves = document.querySelectorAll('.materi-half');
            const materiContents = document.querySelectorAll('.materi-content');
            
            materiHalves.forEach(half => {
                half.addEventListener('click', () => {
                    const contentId = half.getAttribute('data-content');
                    
                    // Update active state
                    materiHalves.forEach(h => {
                        if (h === half) {
                            h.classList.add('active');
                            h.classList.remove('inactive');
                        } else {
                            h.classList.remove('active');
                            h.classList.add('inactive');
                        }
                    });
                    
                    // Show corresponding content
                    materiContents.forEach(content => {
                        if (content.id === contentId) {
                            content.classList.add('active');
                            content.classList.add('curtain-open');
                        } else {
                            content.classList.remove('active');
                            content.classList.remove('curtain-open');
                        }
                    });
                });
            });
        }

        function renderAbsensiPage() {
            const streakCount = document.getElementById('streak-count');
            const streakCircle = document.getElementById('streak-circle');
            const badgesContainer = document.getElementById('badges');
            
            // Update streak count
            streakCount.innerText = state.streak.count || 0;
            
            // Update streak circle visual
            const streakPercentage = Math.min(100, (state.streak.count % 7) * 100 / 7);
            streakCircle.style.background = `conic-gradient(var(--accent) 0%, var(--accent-2) ${streakPercentage}%, rgba(255,255,255,0.1) ${streakPercentage}%)`;
            
            // Render badges
            badgesContainer.innerHTML = '';
            BADGES.forEach(badge => {
                const hasBadge = state.streak.badges.includes(badge.id);
                const badgeEl = document.createElement('div');
                badgeEl.className = `badge ${hasBadge ? '' : 'locked'}`;
                badgeEl.innerHTML = `
                    <div style="font-size: 32px;">${badge.icon}</div>
                    <h4>${hasBadge ? badge.name : '???'}</h4>
                    <p class="small">${hasBadge ? badge.description : 'Kunci terbuka pada streak ' + badge.requiredStreak}</p>
                `;
                badgesContainer.appendChild(badgeEl);
            });
        }

        function renderSettingsPage() {
            // Set initial values for settings toggles
            document.getElementById('toggle-notif-settings').checked = state.settings.notifications;
            document.getElementById('toggle-per-lesson-alarm').checked = state.settings.perLessonAlarm;
            document.getElementById('toggle-dark-mode').checked = state.settings.darkMode;
            document.getElementById('toggle-animations').checked = state.settings.animations;
        }

        // Calendar functions
        function renderCalendar() {
            const calendarEl = document.getElementById('calendar');
            calendarEl.innerHTML = '';
            
            DAYS.forEach(day => {
                const card = document.createElement('div');
                card.className = 'day-card';
                const h = document.createElement('h3');
                h.innerText = DAY_LABEL[day];
                card.appendChild(h);
                
                Object.keys(SLOTS).forEach(slot => {
                    const arr = state.tasks[day][slot] || [];
                    const slotDiv = document.createElement('div');
                    slotDiv.className = 'slot';
                    
                    const left = document.createElement('div');
                    left.innerHTML = `<div class="pill">${SLOTS[slot].label}</div>`;
                    
                    const right = document.createElement('div');
                    if (arr.length === 0) {
                        right.innerHTML = `<span class="pill small">-- kosong --</span>`;
                    } else {
                        right.innerHTML = arr.map((t, i) => 
                            `<span class="pelajaran-badge" data-day="${day}" data-slot="${slot}" data-idx="${i}">${t.title}</span>`
                        ).join(' ');
                    }
                    
                    slotDiv.appendChild(left);
                    slotDiv.appendChild(right);
                    card.appendChild(slotDiv);
                });
                
                const act = document.createElement('div');
                act.className = 'actions';
                const a1 = document.createElement('button');
                a1.className = 'btn';
                a1.innerText = 'Acak';
                a1.onclick = () => randomizeDay(day);
                const a2 = document.createElement('button');
                a2.className = 'btn';
                a2.innerText = 'Lihat';
                a2.onclick = () => showDayDetails(day);
                
                act.appendChild(a1);
                act.appendChild(a2);
                card.appendChild(act);
                calendarEl.appendChild(card);
            });
            
            // Add event listeners to task badges
            document.querySelectorAll('.pelajaran-badge').forEach(el => {
                el.addEventListener('click', () => {
                    openEditTask(
                        el.dataset.day, 
                        el.dataset.slot, 
                        parseInt(el.dataset.idx)
                    );
                });
            });
        }

        function renderToday() {
            const now = new Date();
            const todayDateEl = document.getElementById('today-date');
            todayDateEl.innerText = now.toLocaleDateString('id-ID', {
                weekday: 'long',
                day: 'numeric',
                month: 'long',
                year: 'numeric'
            });
            
            const todayTasksEl = document.getElementById('today-tasks');
            todayTasksEl.innerHTML = '';
            
            const dayKey = DAYS[now.getDay() === 0 ? 6 : now.getDay() - 1];
            
            Object.keys(SLOTS).forEach(slot => {
                const arr = state.tasks[dayKey][slot] || [];
                
                if (arr.length === 0) {
                    const empty = document.createElement('div');
                    empty.className = 'task-item';
                    empty.innerHTML = `
                        <div class="task-left">
                            <div style="width:10px"></div>
                            <div>
                                <strong>${SLOTS[slot].label}</strong>
                                <div class="small">--</div>
                            </div>
                        </div>
                        <div><span class="small">Kosong</span></div>
                    `;
                    todayTasksEl.appendChild(empty);
                } else {
                    arr.forEach((t, i) => {
                        const el = document.createElement('div');
                        el.className = 'task-item';
                        el.innerHTML = `
                            <div class="task-left">
                                <div style="width:8px;height:8px;border-radius:50%;background:${t.subject === 'Game' ? '#f59e0b' : (t.subject.includes('Matematika') ? '#60a5fa' : '#7c3aed')};"></div>
                                <div>
                                    <strong>${t.title}</strong>
                                    <div class="small">${t.subject} â€¢ ${t.duration} menit â€¢ pengingat ${t.remind}m</div>
                                </div>
                            </div>
                            <div style="display:flex;gap:6px;align-items:center">
                                <button class="btn" onclick="openEditTask('${dayKey}','${slot}',${i})">Edit</button>
                                <button class="btn danger" onclick="removeTask('${dayKey}','${slot}',${i})">Hapus</button>
                            </div>
                        `;
                        todayTasksEl.appendChild(el);
                    });
                }
            });
        }

        function renderWeeklySummary() {
            const weeklySummaryEl = document.getElementById('weekly-summary');
            weeklySummaryEl.innerHTML = '';
            
            let totalTasks = 0;
            let completedTasks = 0;
            
            DAYS.forEach(day => {
                Object.keys(SLOTS).forEach(slot => {
                    const tasks = state.tasks[day][slot] || [];
                    totalTasks += tasks.length;
                });
            });
            
            // For demo purposes, let's assume 70% of tasks are completed
            completedTasks = Math.floor(totalTasks * 0.7);
            const progress = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;
            
            weeklySummaryEl.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                    <span class="small">Progress Mingguan</span>
                    <span class="small">${progress}%</span>
                </div>
                <div style="height: 8px; background: rgba(255,255,255,0.1); border-radius: 4px; overflow: hidden;">
                    <div style="height: 100%; width: ${progress}%; background: linear-gradient(90deg, var(--accent), var(--accent-2)); border-radius: 4px;"></div>
                </div>
                <div style="display: flex; justify-content: space-between; margin-top: 8px;">
                    <span class="small">${completedTasks}/${totalTasks} kegiatan</span>
                </div>
            `;
        }

        function renderCalendarModal() {
            const monthYearEl = document.getElementById('calendar-month-year');
            const calendarDaysEl = document.getElementById('calendar-days');
            
            const current = state.currentCalendarView;
            const year = current.getFullYear();
            const month = current.getMonth();
            
            // Set month and year title
            const monthNames = ["Januari", "Februari", "Maret", "April", "Mei", "Juni",
                                "Juli", "Agustus", "September", "Oktober", "November", "Desember"];
            monthYearEl.textContent = `${monthNames[month]} ${year}`;
            
            // Clear previous calendar days
            calendarDaysEl.innerHTML = '';
            
            // Get first day of month and number of days in month
            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            
            // Create empty cells for days before first day of month
            for (let i = 0; i < firstDay; i++) {
                const emptyDay = document.createElement('div');
                emptyDay.className = 'calendar-day';
                calendarDaysEl.appendChild(emptyDay);
            }
            
            // Create cells for each day of the month
            const today = new Date();
            for (let i = 1; i <= daysInMonth; i++) {
                const dayEl = document.createElement('div');
                dayEl.className = 'calendar-day';
                
                // Check if this day is today
                if (i === today.getDate() && month === today.getMonth() && year === today.getFullYear()) {
                    dayEl.classList.add('current');
                }
                
                // Check if this day has tasks
                const dayKey = DAYS[new Date(year, month, i).getDay() === 0 ? 6 : new Date(year, month, i).getDay() - 1];
                let hasTasks = false;
                Object.keys(SLOTS).forEach(slot => {
                    if (state.tasks[dayKey] && state.tasks[dayKey][slot] && state.tasks[dayKey][slot].length > 0) {
                        hasTasks = true;
                    }
                });
                
                if (hasTasks) {
                    dayEl.classList.add('has-tasks');
                }
                
                dayEl.innerHTML = `
                    <div class="day-number">${i}</div>
                `;
                
                // Add click event to show day details
                dayEl.addEventListener('click', () => {
                    showDayModal(year, month, i);
                });
                
                calendarDaysEl.appendChild(dayEl);
            }
        }

        function showDayModal(year, month, day) {
            const modalTitle = document.getElementById('day-modal-title');
            const modalContent = document.getElementById('day-modal-content');
            
            const date = new Date(year, month, day);
            const dayKey = DAYS[date.getDay() === 0 ? 6 : date.getDay() - 1];
            
            modalTitle.textContent = `Kegiatan pada ${date.toLocaleDateString('id-ID', { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' })}`;
            
            let hasTasks = false;
            let tasksHTML = '';
            
            Object.keys(SLOTS).forEach(slot => {
                const tasks = state.tasks[dayKey] && state.tasks[dayKey][slot] ? state.tasks[dayKey][slot] : [];
                
                if (tasks.length > 0) {
                    hasTasks = true;
                    tasksHTML += `<h4>${SLOTS[slot].label}</h4>`;
                    
                    tasks.forEach((task, index) => {
                        tasksHTML += `
                            <div class="day-task-item">
                                <strong>${task.title}</strong> (${task.subject})<br>
                                <span class="small">Durasi: ${task.duration} menit</span>
                            </div>
                        `;
                    });
                }
            });
            
            if (hasTasks) {
                modalContent.innerHTML = tasksHTML;
            } else {
                modalContent.innerHTML = '<p>Tidak ada kegiatan yang dijadwalkan untuk hari ini.</p>';
            }
            
            document.getElementById('day-modal').style.display = 'flex';
        }

        // Task management functions
        function setupTaskModal() {
            // Populate subject dropdown
            const subjectSelect = document.getElementById('m-inp-subject');
            SUBJECTS.forEach(subject => {
                const option = document.createElement('option');
                option.value = subject;
                option.textContent = subject.startsWith('mid_') ? 
                    subject.replace('mid_', '(MID) ') : subject;
                subjectSelect.appendChild(option);
            });
            
            // Populate day dropdown
            const daySelect = document.getElementById('m-inp-day');
            DAYS.forEach(day => {
                const option = document.createElement('option');
                option.value = day;
                option.textContent = DAY_LABEL[day];
                daySelect.appendChild(option);
            });
            
            // Add event listeners
            document.getElementById('btn-add').addEventListener('click', openModalForNew);
            document.getElementById('m-cancel-task').addEventListener('click', closeModal);
            document.getElementById('m-save-task').addEventListener('click', saveTask);
            
            // Clear button
            document.getElementById('btn-clear').addEventListener('click', () => {
                if (confirm('Reset semua jadwal ke keadaan kosong?')) {
                    DAYS.forEach(day => {
                        state.tasks[day] = { slot1: [], slot2: [], slot3: [], slot4: [], slot5: [] };
                    });
                    saveState();
                    renderHomePage();
                }
            });
            
            // View today button
            document.getElementById('btn-view-today').addEventListener('click', () => {
                const today = new Date();
                const dayKey = DAYS[today.getDay() === 0 ? 6 : today.getDay() - 1];
                showDayDetails(dayKey);
            });
        }

        function openEditTask(day, slot, index) {
            const task = state.tasks[day][slot][index];
            
            document.getElementById('m-inp-title').value = task.title;
            document.getElementById('m-inp-subject').value = task.subject;
            document.getElementById('m-inp-day').value = day;
            document.getElementById('m-inp-slot').value = slot;
            document.getElementById('m-inp-duration').value = task.duration;
            document.getElementById('m-inp-remind').value = task.remind;
            
            // Store editing context
            window.editingTask = { day, slot, index };
            
            document.getElementById('taskModal').style.display = 'block';
        }

        function openModalForNew() {
            document.getElementById('m-inp-title').value = '';
            document.getElementById('m-inp-subject').value = 'Matematika';
            document.getElementById('m-inp-duration').value = 60;
            document.getElementById('m-inp-remind').value = 10;
            
            // Clear editing context
            window.editingTask = null;
            
            document.getElementById('taskModal').style.display = 'block';
        }

        function closeModal() {
            document.getElementById('taskModal').style.display = 'none';
        }

        function saveTask() {
            const title = document.getElementById('m-inp-title').value.trim() || '(Tanpa Judul)';
            const subject = document.getElementById('m-inp-subject').value;
            const day = document.getElementById('m-inp-day').value;
            const slot = document.getElementById('m-inp-slot').value;
            const duration = parseInt(document.getElementById('m-inp-duration').value) || 60;
            const remind = parseInt(document.getElementById('m-inp-remind').value) || 0;
            
            const task = {
                title,
                subject,
                duration,
                remind,
                createdAt: Date.now()
            };
            
            if (window.editingTask) {
                // Update existing task
                const { day, slot, index } = window.editingTask;
                state.tasks[day][slot][index] = task;
                window.editingTask = null;
            } else {
                // Add new task
                if (!state.tasks[day][slot]) {
                    state.tasks[day][slot] = [];
                }
                state.tasks[day][slot].push(task);
            }
            
            saveState();
            renderHomePage();
            closeModal();
        }

        function removeTask(day, slot, index) {
            if (confirm('Hapus kegiatan ini?')) {
                state.tasks[day][slot].splice(index, 1);
                saveState();
                renderHomePage();
            }
        }

        function randomizeDay(day) {
            const pool = ["Matematika", "Bahasa Indonesia", "Bahasa Inggris", "Sejarah", "PKN", "Tugas Film", "Ngoding", "Banner", "Game", "mid_matematika", "mid_bahasa_indonesia"];
            
            Object.keys(SLOTS).forEach(slot => {
                const choice = pool[Math.floor(Math.random() * pool.length)];
                state.tasks[day][slot] = [{
                    title: (choice.startsWith('mid_') ? 'MID: ' + choice.replace('mid_', '') : choice) + (choice === 'Game' ? ' (Istirahat)' : ''),
                    subject: choice,
                    duration: choice === 'Game' ? 30 : 60,
                    remind: 10,
                    createdAt: Date.now()
                }];
            });
            
            saveState();
            renderHomePage();
        }

        function showDayDetails(day) {
            let details = `=== ${DAY_LABEL[day]} ===\n\n`;
            
            Object.keys(SLOTS).forEach(slot => {
                const tasks = state.tasks[day][slot] || [];
                details += `${SLOTS[slot].label}:\n`;
                
                if (tasks.length === 0) {
                    details += "  - (kosong)\n";
                } else {
                    tasks.forEach(task => {
                        details += `  - ${task.title} (${task.subject}) [${task.duration}m]\n`;
                    });
                }
                details += "\n";
            });
            
            alert(details);
        }

        // Attendance functions
        function checkinToday() {
            const todayKey = new Date().toISOString().slice(0, 10);
            const last = state.streak.lastCheck;
            
            if (last === todayKey) {
                alert('Kamu sudah check-in hari ini ðŸ‘');
                return;
            }
            
            // If last check was yesterday -> increment streak else reset
            const yesterday = new Date();
            yesterday.setDate(yesterday.getDate() - 1);
            const yesterdayKey = yesterday.toISOString().slice(0, 10);
            
            if (last === yesterdayKey) {
                state.streak.count += 1;
            } else {
                state.streak.count = 1;
            }
            
            state.streak.lastCheck = todayKey;
            
            // Check for new badges
            checkForNewBadges();
            
            saveState();
            renderAbsensiPage();
            alert('Check-in tercatat âœ…');
        }

        function checkForNewBadges() {
            BADGES.forEach(badge => {
                if (!state.streak.badges.includes(badge.id) && state.streak.count >= badge.requiredStreak) {
                    state.streak.badges.push(badge.id);
                    alert(`Selamat! Kamu mendapatkan badge: ${badge.name}`);
                }
            });
        }

        // Data management functions
        function exportData() {
            const data = JSON.stringify(state, null, 2);
            const blob = new Blob([data], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = 'tka_planner_backup.json';
            a.click();
            
            URL.revokeObjectURL(url);
        }

        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = e => {
                const file = e.target.files[0];
                const reader = new FileReader();
                
                reader.onload = event => {
                    try {
                        const importedState = JSON.parse(event.target.result);
                        state = { ...state, ...importedState };
                        saveState();
                        alert('Data berhasil diimpor!');
                        location.reload();
                    } catch (error) {
                        alert('Error mengimpor data: Format file tidak valid');
                    }
                };
                
                reader.readAsText(file);
            };
            
            input.click();
        }

        function resetData() {
            if (confirm('Apakah Anda yakin ingin menghapus semua data? Tindakan ini tidak dapat dibatalkan.')) {
                localStorage.removeItem(STORAGE_KEY);
                alert('Data telah direset. Halaman akan dimuat ulang.');
                location.reload();
            }
        }

        // Theme function
        function applyTheme() {
            if (state.settings.darkMode) {
                document.documentElement.style.setProperty('--bg1', 'linear-gradient(135deg, #0f172a 0%, #0b1220 40%, #0b4a6f 100%)');
                document.documentElement.style.setProperty('--card', 'rgba(255, 255, 255, 0.06)');
                document.documentElement.style.setProperty('--glass', 'rgba(255, 255, 255, 0.04)');
                document.documentElement.style.setProperty('--muted', 'rgba(255, 255, 255, 0.7)');
            } else {
                document.documentElement.style.setProperty('--bg1', 'linear-gradient(135deg, #e6eef8 0%, #d9e3f2 40%, #a8c6e0 100%)');
                document.documentElement.style.setProperty('--card', 'rgba(255, 255, 255, 0.8)');
                document.documentElement.style.setProperty('--glass', 'rgba(255, 255, 255, 0.7)');
                document.documentElement.style.setProperty('--muted', 'rgba(0, 0, 0, 0.7)');
            }
        }

        // Initialize the application when the page loads
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>